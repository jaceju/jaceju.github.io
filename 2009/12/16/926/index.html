<!DOCTYPE html><html lang="zh-tw"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> [五分鐘教室] 重構多參數函式 · 網站製作學習誌</title><meta name="description" content="A Blog Powered By Hexo"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/jekyll.css"><!--[if lt IE 9]>
<script src="js/html5shiv.min.js"></script>
<script src="js/respond.min.js"></script>
<![endif]--></head><body><header class="row-flex-row limit-width vh-center"><a href="/" class="logo"><img src="/favicon.png"></a><nav><ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-link">主页</a></li><li class="nav-list-item"><a href="/archives/" class="nav-link active">   博客</a></li><li class="nav-list-item"><a href="/atom.xml" class="nav-link">rss</a></li><li class="nav-list-item"><a href="https://github.com/xxxxx" target="_blank" class="nav-link">   github</a></li></ul></nav></header><div class="container limit-width"><section class="row-flex-row"><div class="post"><article class="post-block"><h2 class="post-title"><a href="/2009/12/16/926/" class="post-title-link">[五分鐘教室] 重構多參數函式</a></h2><div class="post-meta"><ul class="post-tag-list"><li class="post-tag-item"><a href="/tags/PHP/" class="post-tag-link">PHP</a></li></ul><div class="post-time">星期二, 二月 2日 2016</div></div><div class="post-content"><p>我們在撰寫 PHP 函式 (或類別的方法) 時，多少都會帶入一些參數，例如：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function myfunc($arg1, $arg2, ...) &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>一般常見的函式，它們的參數數量大多只會兩三個，但如果有參數的數量很多時該怎麼辦？</p>
<a id="more"></a>
<h2 id="多參數的困擾">多參數的困擾</h2><p>當一個 PHP 函式的參數多於三個以上時，其實就會浮現一些讓程式開發人員困擾的問題。</p>
<h3 id="順序不易記憶">順序不易記憶</h3><p>當函式名稱語意不明時，加上如果沒有 IDE 的協助，你會很難瞭解參數的先後順序。</p>
<p>像我自己就很常搞錯 iconv 的參數順序：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iconv($in_charset, $out_charset, $str)</span><br></pre></td></tr></table></figure>
<p>每次使用時，我都要回去看看官方手冊，才會記得第一個參數是輸入編碼而不是要轉換的字串。</p>
<h3 id="預設值">預設值</h3><p>還有一個狀況是參數如果有預設值時，一定是將它放在最右邊的參數。例如 htmlspecialchars 這個函式：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">htmlspecialchars($string[, $quote_style = ENT_COMPAT[, $charset = &#39;ISO-8859-1&#39;[, $double_encode = true]]])</span><br></pre></td></tr></table></figure>
<p>如果今天我們只想要載入第一個參數 (要轉換的字串) 和第三個參數 (編碼) ，這是做不到的；我們不得不把第二個參數 (引號型態) 也一併代入，即便我們不想更改它的預設值。</p>
<h2 id="解決方式">解決方式</h2><p>我們可以用關聯式陣列來解決前述的問題，也就是把多個參數變成一個陣列。</p>
<p>例如以前面的 iconv 為例，我們自己定義了一個函式將它包裝起來，然後把原來的三個參數變成一個參數陣列：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// &#23450;&#32681;&#10;function my_iconv($options)&#10;&#123;&#10;    return iconv($options[&#39;inputCharset&#39;], $options[&#39;outputCharset&#39;], $options[&#39;convertString&#39;]);&#10;&#125;&#10;&#10;//&#29992;&#27861;&#10;echo my_iconv(array(&#10;    &#39;convertString&#39; =&#62; &#39;test&#39;,&#10;    &#39;inputCharset&#39; =&#62; &#39;BIG5&#39;,&#10;    &#39;outputCharset&#39; =&#62; &#39;UTF-8&#39;,&#10;));</span><br></pre></td></tr></table></figure>
<p>這樣一來，不僅我們不用擔心參數順序的問題，還可以很容易地分辨出每個參數值所代表的意義。 </p>
<p>註：這種作法在一些 JavaScript Library 裡也常見到，像是 jQuery 很多方法都是以物件來當做參數組代入。</p>
<h3 id="考慮預設值">考慮預設值</h3><p>那麼如果參數需要預設值時該怎麼做呢？這時候我們可以在函式裡預先放置一個含有預設值的陣列，來跟使用者傳入的陣列做合併的動作。例如：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function my_htmlspecialchars($str, $options = array())&#10;&#123;&#10;    $options = (array) $options;&#10;    $options += array(&#10;        &#39;quoteStyle&#39; =&#62; ENT_COMPAT,&#10;        &#39;charset&#39; =&#62; &#39;ISO-8859-1&#39;,&#10;        &#39;doubleEncode&#39; =&#62; true,&#10;    );&#10;    return htmlspecialchars(&#10;        $str,&#10;        $options[&#39;quoteStyle&#39;],&#10;        $options[&#39;charset&#39;],&#10;        $options[&#39;doubleEncode&#39;]&#10;    );&#10;&#125;&#10;&#10;echo my_htmlspecialchars(&#39;&#60;test&#62;&#28204;&#35430;&#60;/test&#62;&#39;, array(&#39;charset&#39; =&#62; &#39;UTF-8&#39;));</span><br></pre></td></tr></table></figure>
<p>這裡我用了「 + 」這個可以用來合併陣列的操作符，它會以左邊陣列裡的值為主，然後將右邊的值合併進來。</p>
<p>這樣一來，右邊的陣列裡我們可以放置預設的參數值，而不必擔心使用者沒有帶入中間必要的參數。</p>
<p>註：你也許會發現我沒有把 $str 放到 $options 裡，這是因為它本身就是必要的參數。</p>
<h3 id="缺點">缺點</h3><p>使用關聯式陣列當做參數值也不能說完全沒有缺點，實際應用上我就發現了以下幾個問題：</p>
<ul>
<li><p>比原本的程式寫法囉嗦了些，你得多打好多字才能達到相同的目的。</p>
</li>
<li><p>參數名稱不易記憶，且預設值要寫在註解裡，而不是寫在定義裡；這樣一來有些 IDE 如果不顯示函式註解的話，還是得看手冊才能知道這些參數的名稱與預設值。</p>
</li>
</ul>
<h2 id="結論">結論</h2><p>用關聯式陣列來取代多參數這個方法，最大的好處就是當後續維護的開發人員，可以不必再回頭查看手冊，一眼就能知道每個參數值所代表的意義。</p>
<p>不過這個方法還是得看狀況使用，因為它所帶來的缺點可能會讓很多開發人員覺得很不便。所以在設計函式時，一定要仔細思考如何去定義才能讓開發者方便使用這些它們。</p>
</div></article><div class="pagination"><a href="/2009/12/26/930/" class="pagination-prev">PREV</a><a href="/2009/12/13/918/" class="pagination-next">NEXT</a></div></div><aside class="sidebar"><h3>分类标签</h3><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ASP/">ASP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AngularJS/">AngularJS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BDD/">BDD</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Backbone-js/">Backbone.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/">CSS</a></li></ul><h3>最新文章</h3><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2015/11/09/php-closure-testing/">在 PHPUnit 中測試需要 closure 的函式</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/27/web-testing-with-phpunit-mink/">利用 PHPUnit 與 Mink 來做 Web 測試</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/14/what-is-test/">這樣寫測試錯了嗎？</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/05/simple-refatoring-example-01/">邁向 PHP 重構之路 - 以 Laravel 程式碼片段為例</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/07/29/laravel-mailcatcher/">在 Laravel 上用 MailCatcher 發送測試信件</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/07/26/laravel-events-broadcasting/">Laravel 5.1 Events Broadcasting 實務練習</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/07/08/front-end-framework-summary/">幾個有興趣的前端框架</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/06/10/laravel-5-1/">Laravel 5.1 正式釋出</a></li></ul></aside></section></div><div class="extra"></div><footer class="footer"><div class="row-flex-row limit-width vh-center"><div class="copyright"><P>© 2016 <a href="/">Jace Ju</P></div><div class="power"><p><a href="http://pinggod.com/">Sean Sun</a>, 
<a href="https://hexo.io">Hexo</a>, 
<a href="https://github.com/">GitHub</a>, 
<a href="https://jekyllrb.com/">Jekyll</a></p></div></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "//hm.baidu.com/hm.js?a36e15d9e2adec9a21fcdd9f686b1ed2";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>