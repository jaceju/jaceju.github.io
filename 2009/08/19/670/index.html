<!DOCTYPE html><html lang="zh-tw"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> [PHP] 瞭解 static 關鍵字 · 網站製作學習誌</title><meta name="description" content="A Blog Powered By Hexo"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/jekyll.css"><!--[if lt IE 9]>
<script src="js/html5shiv.min.js"></script>
<script src="js/respond.min.js"></script>
<![endif]--></head><body><header class="row-flex-row limit-width vh-center"><a href="/" class="logo"><img src="/favicon.png"></a><nav><ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-link">主页</a></li><li class="nav-list-item"><a href="/archives/" class="nav-link active">   博客</a></li><li class="nav-list-item"><a href="/atom.xml" class="nav-link">rss</a></li><li class="nav-list-item"><a href="https://github.com/xxxxx" target="_blank" class="nav-link">   github</a></li></ul></nav></header><div class="container limit-width"><section class="row-flex-row"><div class="post"><article class="post-block"><h2 class="post-title"><a href="/2009/08/19/670/" class="post-title-link">[PHP] 瞭解 static 關鍵字</a></h2><div class="post-meta"><ul class="post-tag-list"><li class="post-tag-item"><a href="/tags/PHP/" class="post-tag-link">PHP</a></li></ul><div class="post-time">星期二, 二月 2日 2016</div></div><div class="post-content"><p>先前同事詢問有關 PHP static 關鍵字的用法，這裡我簡單整理一下。</p>
<p>static 主要用途在於定義一個變數空間，讓函式或類別可以保留住該變數的值，直到下次的存取。</p>
<p>以下就各別來探討 static 在函式與類別中的用法。</p>
<a id="more"></a>
<h2 id="函式裡的_static_關鍵字">函式裡的 static 關鍵字</h2><p>先來看看以下的例子：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function getCount()&#10;&#123;&#10;    static $count = 0;&#10;    $count ++;&#10;    return $count;&#10;&#125;&#10;&#10;for ($i = 0; $i &#60; 10; $i ++) &#123;&#10;   echo getCount(), &#34;\n&#34;;&#10;&#125;&#10;/* output:&#10;1&#10;2&#10;3&#10;4&#10;5&#10;6&#10;7&#10;8&#10;9&#10;10&#10;*/</span><br></pre></td></tr></table></figure>
<p>首先我們在 getCount() 這個方法中定義了一個 static 變數 $count ，然後每次呼叫 getCount() 時，就會對 $count 作累加的動作。</p>
<p>接著我們透過迴圈執行十次 getCount() 方法，便可得到了 1 ~ 10 的輸出結果。</p>
<p>這是因為將變數宣告為 static 後，第一次呼叫 getCount() 這個方法時，會為 $count 保留一塊記憶體空間；而當脫離了 getCount() 的變數作用域後，這個記憶體空間並不會被消滅掉，而會在下一次呼叫 getCount() 方法時，再次被配置進來，並還原先前的變數值。</p>
<p>因此，除了第一次呼叫 getCount() 方法外，接下來的每次呼叫都會讓 $count 值累加，而得到 1 ~ 10 的輸出結果；如果把 static 關鍵字拿掉，就會輸出十次的 1 。</p>
<h2 id="應用在遞迴上的_static_關鍵字">應用在遞迴上的 static 關鍵字</h2><p>瞭解函式中的 static 關鍵字用法後，我們來看一個應用的例子：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function fibV1($n)&#10;&#123;&#10;    if ($n &#60;= 2) &#123;&#10;        return 1;&#10;    &#125; else &#123;&#10;        return fibV1($n - 2) + fibV1($n - 1);&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>這是 PHP 版的 Fibonacci Sequence 遞迴函式，原理我就不多說明了。先來看看它在參數為 20 時所需要的執行時間：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$start_time = (float) microtime(true);&#10;echo fibV1(20), &#34;\n&#34;;&#10;$end_time = (float) microtime(true);&#10;echo &#34;Spent Time: &#34;, ($end_time - $start_time), &#34;(s)\n&#34;;&#10;/* output:&#10;6765&#10;Spent Time: 0.26100397109985(s)&#10;*/</span><br></pre></td></tr></table></figure>
<p>這裡代入的數字越大，執行時間會越長。</p>
<p>現在我們用 static 關鍵字來改寫：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function fibV2($n)&#10;&#123;&#10;    static $result = array();&#10;    if (!isset($result[$n])) &#123;&#10;        if ($n &#60;= 2) &#123;&#10;            $result[$n] = 1;&#10;        &#125; else &#123;&#10;            $result[$n] = fibV2($n - 2) + fibV2($n - 1);&#10;        &#125;&#10;    &#125;&#10;    return $result[$n];&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>然後再來看執行的時間：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$start_time = (float) microtime(true);&#10;echo fibV2(20), &#34;\n&#34;;&#10;$end_time = (float) microtime(true);&#10;echo &#34;Spent Time: &#34;, ($end_time - $start_time), &#34;(s)\n&#34;;&#10;/* output:&#10;6765&#10;Spent Time: 0.0009009838104248(s)&#10;*/</span><br></pre></td></tr></table></figure>
<p>速度竟然差了快三百倍！為什麼？</p>
<p>其實是因為這裡的 static 關鍵字扮演了 cache 的角色，讓程式不用重新計算已經算好的結果。而使用了 static 關鍵字後，也使得執行時間不會再隨著代入數字變大而變長。</p>
<p>註：不是任何遞迴函式都可以用 static 變數來做 cache ，在使用上要特別注意這一點。</p>
<h2 id="類別裡的_static_關鍵字">類別裡的 static 關鍵字</h2><p>在類別裡的 static 關鍵字，也扮演了類似的角色。我們利用 static 在類別裡定義的屬性，會佔用類別的記憶體空間。而透過同一類別所生成的物件，會彼此共享這個 static 屬性；所以不論我們產生多少同類別的物件，它們都會存取到同一個 static 類別屬性。</p>
<p>來看看以下的例子：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class DB&#10;&#123;&#10;    private static $_instance = null;&#10;&#10;    private static $_instanceCount = 0;&#10;    private function __construct()&#10;    &#123;&#10;        self::$_instanceCount ++;&#10;    &#125;&#10;&#10;    public static function getInstance()&#10;    &#123;&#10;        if (null === self::$_instance) &#123;&#10;            self::$_instance = new self();&#10;        &#125;&#10;        return self::$_instance;&#10;    &#125;&#10;&#10;    public function getInstanceCount()&#10;    &#123;&#10;        return self::$_instanceCount;&#10;    &#125;&#10;&#125;&#10;$db1 = DB::getInstance();&#10;echo $db1-&#62;getInstanceCount(), &#34;\n&#34;; // 1&#10;$db2 = DB::getInstance();&#10;echo $db2-&#62;getInstanceCount(), &#34;\n&#34;; // 1</span><br></pre></td></tr></table></figure>
<p>範例即為經典的 Singleton 模式，原理這裡先不多做說明。</p>
<p>這裡我們定義了兩個類別 static 屬性，分別是 $_instance 及 $_instanceCount ；而透過 static 定義的類別屬性，在類別裡存取時要用 self 關鍵字加上雙冒號 (::) ，例如 self::$_instance 。</p>
<p>接著我們可以看到在 getInstance() 方法中，如果 self::$_instance 是 null 的話，表示是第一次呼叫，那麼程式就會透過私有的建構式產生一個 DB 物件指定給 self::$_instance 變數，最後再將它回傳出去。這時雖然 getInstance() 裡的變數作用域已經結束，但 self::$_instance 卻會保留下來。</p>
<p>下一次 getInstance() 呼叫時，因為 self::$_instance 已經不再是 null 值，所以就會直接將其內容回傳給呼叫的程式了。</p>
<p>也因為這個原因，所以整個程式執行下來， DB 的 __construct() 方法也只被執行過一次，使得 self::$_instanceCount 也只累加一次，其結果永遠為 1 。</p>
<h2 id="結論">結論</h2><p>一般 PHP 開發者很少會去使用 static 關鍵字，因為平常會用到 static 的場合其實也不多。這裡我再做一次 static 使用時機的重點整理：</p>
<ul>
<li>需要記住上一次函式執行的結果。</li>
<li>某些可以保留執行結果的遞迴函式。</li>
<li>不希望因為物件個體不同，進而被影響的類別屬性。</li>
<li>類別的 Singleton 模式。</li>
</ul>
<p>希望透過上面的說明，能讓大家對 static 關鍵字有進一步的瞭解。</p>
</div></article><div class="pagination"><a href="/2009/09/01/683/" class="pagination-prev">PREV</a><a href="/2009/08/13/668/" class="pagination-next">NEXT</a></div></div><aside class="sidebar"><h3>分类标签</h3><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ASP/">ASP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AngularJS/">AngularJS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BDD/">BDD</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Backbone-js/">Backbone.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/">CSS</a></li></ul><h3>最新文章</h3><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2015/11/09/php-closure-testing/">在 PHPUnit 中測試需要 closure 的函式</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/27/web-testing-with-phpunit-mink/">利用 PHPUnit 與 Mink 來做 Web 測試</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/14/what-is-test/">這樣寫測試錯了嗎？</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/05/simple-refatoring-example-01/">邁向 PHP 重構之路 - 以 Laravel 程式碼片段為例</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/07/29/laravel-mailcatcher/">在 Laravel 上用 MailCatcher 發送測試信件</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/07/26/laravel-events-broadcasting/">Laravel 5.1 Events Broadcasting 實務練習</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/07/08/front-end-framework-summary/">幾個有興趣的前端框架</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/06/10/laravel-5-1/">Laravel 5.1 正式釋出</a></li></ul></aside></section></div><div class="extra"></div><footer class="footer"><div class="row-flex-row limit-width vh-center"><div class="copyright"><P>© 2016 <a href="/">Jace Ju</P></div><div class="power"><p><a href="http://pinggod.com/">Sean Sun</a>, 
<a href="https://hexo.io">Hexo</a>, 
<a href="https://github.com/">GitHub</a>, 
<a href="https://jekyllrb.com/">Jekyll</a></p></div></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "//hm.baidu.com/hm.js?a36e15d9e2adec9a21fcdd9f686b1ed2";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>