<!DOCTYPE html><html lang="zh-TW"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>在 Laravel 中使用 Behat 來加強測試的可讀性 - 進階篇 | 網站製作學習誌</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="在 Laravel 中使用 Behat 來加強測試的可讀性 - 進階篇"><meta name="twitter:description" content="記錄在開發網站時所學的一切"><meta name="og:title" content="在 Laravel 中使用 Behat 來加強測試的可讀性 - 進階篇"><meta name="og:site_name" content="網站製作學習誌"><meta name="og:description" content="記錄在開發網站時所學的一切"><meta name="og:type" content="article"><meta name="og:image" content=""></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">在 Laravel 中使用 Behat 來加強測試的可讀性 - 進階篇</h1><a id="logo" href="/.">網站製作學習誌</a><p class="description">記錄在開發網站時所學的一切</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首頁</i></a><a href="/archives/"><i class="fa fa-archive"> 所有文章</i></a><a href="/about/"><i class="fa fa-user"> 關於</i></a><a href="/atom.xml"><i class="fa fa-rss"> 訂閱</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">在 Laravel 中使用 Behat 來加強測試的可讀性 - 進階篇</h1><div class="post-meta">Nov 9, 2018</div><div class="post-content"><p>在<a href="https://jaceju.net/2018-11-08-behat-in-laravel/">上一篇文章</a>中，我介紹了如何把 Behat 整合到 Laravel 裡；不過後來我發現在專案規格越來越複雜時，把所有 step definitions 都寫在 <code>FeatureContext</code> 類別中變得非常不易閱讀。另一個問題就是我不想要用 <code>putenv</code> 函式來定義環境變數，而是希望能有 <a href="https://github.com/laracasts/Behat-Laravel-Extension" target="_blank" rel="noopener">Behat-Laravel-Extension</a> 把環境變數放在 <code>.env.behat</code> 裡的用法。</p>
<p>而經過不斷地改良後，我找到了一個目前我很滿意的做法；所以接下來我會延續上一篇的範例來介紹新的做法。</p>
<h2 id="改良環境改數的設定方式"><a href="#改良環境改數的設定方式" class="headerlink" title="改良環境改數的設定方式"></a>改良環境改數的設定方式</h2><p>為了讓 Behat 執行時可以讀取 <code>.env.behat</code> ，我們需要在 Application 初始化時載入新的環境設定檔案。因此我們就不能直接用 Laravel 提供的 <code>Tests\CreatesApplication</code> 這個 trait 了，因為它預設會載入 <code>.env</code> 檔；這時這也表示我們不再需要直接繼承 <code>Tests/TestCase</code> 這個類別，因為它也只是使用了 <code>Tests\CreatesApplication</code> 這個 trait 。</p>
<p>取而代之的是我們改為繼承 <code>Illuminate\Foundation\Testing\TestCase</code> 這個類別，然後自行覆寫 <code>createApplication</code> 這個方法：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Behat</span>\<span class="title">Behat</span>\<span class="title">Context</span>\<span class="title">Context</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Console</span>\<span class="title">Kernel</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Testing</span>\<span class="title">TestCase</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FeatureContext</span> <span class="keyword">extends</span> <span class="title">TestCase</span> <span class="keyword">implements</span> <span class="title">Context</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">const</span> ENV_FILE = <span class="string">'.env.behat'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> \Illuminate\Foundation\Application</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">createApplication</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $app = <span class="keyword">require</span> <span class="keyword">__DIR__</span> . <span class="string">'/../../bootstrap/app.php'</span>;</span><br><span class="line"></span><br><span class="line">        $app-&gt;loadEnvironmentFrom(<span class="keyword">self</span>::ENV_FILE);</span><br><span class="line"></span><br><span class="line">        $app-&gt;make(Kernel::class)-&gt;bootstrap();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $app;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>可以看到新的 <code>createApplication</code> 方法主要是在 <code>Kernel::bootstrap</code> 之前，讓 Application 改讀 <code>.env.behat</code> 。</p>
<p>接下加入 <code>.env.behat</code> ，內容可參考 <code>phpunit.xml</code> 裡的 <code>&lt;php&gt;</code> 區段設定，例如：</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">APP_ENV</span>=testing</span><br><span class="line"><span class="attr">DB_CONNECTION</span>=sqlite</span><br><span class="line"><span class="attr">DB_DATABASE</span>=:memory:</span><br><span class="line"><span class="attr">BROADCAST_DRIVER</span>=log</span><br><span class="line"><span class="attr">CACHE_DRIVER</span>=array</span><br><span class="line"><span class="attr">SESSION_DRIVER</span>=array</span><br><span class="line"><span class="attr">BCRYPT_ROUNDS</span>=<span class="number">4</span></span><br><span class="line"><span class="attr">QUEUE_DRIVER</span>=sync</span><br></pre></td></tr></table></figure>
<h2 id="分類-Step-definitions"><a href="#分類-Step-definitions" class="headerlink" title="分類 Step definitions"></a>分類 Step definitions</h2><p>當 step definitions 很多時，通通都放在 <code>FeatureContext</code> 類別裡就不是個明智的做法了。所以接下來我依照 step definitions 的類型來建立不同的 Context 檔，這樣維護起來也很方便。</p>
<p>首先我們要在專案根目錄下建立一個 <code>behat.yml</code> 檔， Behat 在執行時會讀取它裡面的設定：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">default:</span></span><br><span class="line"><span class="attr">  suites:</span></span><br><span class="line"><span class="attr">    default:</span></span><br><span class="line"><span class="attr">      contexts:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">ApiFeatureContext</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">DatabaseAssertionContext</span></span><br></pre></td></tr></table></figure>
<p>然後我們執行：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vendor/bin/behat --init</span><br></pre></td></tr></table></figure>
<p>這麼一來 Behat 會幫我們自動產生所有 context 檔案：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">+f features/bootstrap/ApiFeatureContext.php - place your definitions, transformations and hooks here</span><br><span class="line">+f features/bootstrap/DatabaseAssertionContext.php - place your definitions, transformations and hooks here</span><br></pre></td></tr></table></figure>
<p>註：雖然這裡只針對範例拆分，但你可以加入其它的 context 檔，後面我會給一些例子。</p>
<p>接著編輯每個 context 檔，先讓它們繼承 <code>FeatureContext</code> 類別，並拿掉 <code>__construct</code> 建構子；然後再把原來放在 <code>FeatureContext</code> 類別裡的 step definitions 搬到對應的 context 類別裡。</p>
<p>API 相關的 step definitions 放在 <code>ApiFeatureContext</code> 類別：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Behat</span>\<span class="title">Gherkin</span>\<span class="title">Node</span>\<span class="title">TableNode</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ApiFeatureContext</span> <span class="keyword">extends</span> <span class="title">FeatureContext</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> $apiUrl = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> $apiBody = [];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> \Illuminate\Foundation\Testing\TestResponse</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> $response;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Given</span> API 網址為 :apiUrl</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $apiUrl</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">apiUrl</span><span class="params">(string $apiUrl)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;apiUrl = $apiUrl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Given</span> API 附帶資料為</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> TableNode $table</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">apiBody</span><span class="params">(TableNode $table)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;apiBody = $table-&gt;getHash()[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@When</span> 以 :method 方法要求 API</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $method</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">request</span><span class="params">(string $method)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;response = <span class="keyword">$this</span>-&gt;json($method, <span class="keyword">$this</span>-&gt;apiUrl, <span class="keyword">$this</span>-&gt;apiBody);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Then</span> 回傳狀態應為 :statusCode</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> int $statusCode</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">assertStatus</span><span class="params">(int $statusCode)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;response-&gt;assertStatus($statusCode);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>資料庫相關的 step definitions 放在 <code>DatabaseAssertionContext</code> 類別：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Behat</span>\<span class="title">Gherkin</span>\<span class="title">Node</span>\<span class="title">TableNode</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DatabaseAssertionContext</span> <span class="keyword">extends</span> <span class="title">FeatureContext</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Then</span> 資料表 :tableName 應有資料</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $tableName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> TableNode $table</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">assertTableRecordExisted</span><span class="params">(string $tableName, TableNode $table)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;assertDatabaseHas($tableName, $table-&gt;getHash()[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>當然不僅 API 和資料庫可以拆分，例如建立 Model 資料、 Event 或 Queue 相關的 step definitions 可以這樣做。</p>
<p>Model Factory ：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ModelFactoryContext</span> <span class="keyword">extends</span> <span class="title">FeatureContext</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Given</span> 存在使用者 :name</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $name</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">user</span><span class="params">(string $name)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        factory(\App\User::class)-&gt;create([</span><br><span class="line">            <span class="string">'name'</span> =&gt; $name,</span><br><span class="line">        ]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Event 相關：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Events</span>\<span class="title">UserCreated</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>\<span class="title">Event</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EventAssertionContext</span> <span class="keyword">extends</span> <span class="title">FeatureContext</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@BeforeScenario</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setUpFake</span><span class="params">()</span>: <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Event::fake();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Then</span> 應發送事件「已新增用戶」</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">assertDeployStatusCreatedEventDispatched</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Event::assertDispatched(UserCreated::class, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其他就請大家自行發揮了。</p>
<h2 id="進一步改良"><a href="#進一步改良" class="headerlink" title="進一步改良"></a>進一步改良</h2><p>上述的調整有個缺點，就是 <code>FeatureContext::before</code> 方法及 <code>FeatureContext::after</code> 方法都會初始化 Context 類別時都跑一次，但每個情境在執行時都會再次初始化所有 Context 類別；換句話說每個情境在執行時，有幾個 Context 類別，就會執行幾次 <code>FeatureContext::before</code> 方法及 <code>FeatureContext::after</code> 方法。這樣一來 <code>$this-&gt;app</code> 就會被重複初始化，徒然浪費執行時間。</p>
<p>我們希望 <code>FeatureContext::before</code> 方法及 <code>FeatureContext::after</code> 方法在每個情境執行前後各執行一次就好，可是每個 context 物件實體因為作用域的關係，它們拿到的 <code>$this-&gt;app</code> 都不會是同一個；這時也需要一個機制來記住已經被初始化的 <code>$this-app</code> ，才不用每個 context 都做一次。</p>
<p>綜合上述的想法，最後完整的 <code>FeatureContext</code> 類別如下：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Behat</span>\<span class="title">Behat</span>\<span class="title">Context</span>\<span class="title">Context</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Console</span>\<span class="title">Kernel</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Testing</span>\<span class="title">RefreshDatabase</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Testing</span>\<span class="title">TestCase</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">FeatureContext</span> <span class="keyword">extends</span> <span class="title">TestCase</span> <span class="keyword">implements</span> <span class="title">Context</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">RefreshDatabase</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">const</span> ENV_FILE = <span class="string">'.env.behat'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> \Illuminate\Foundation\Application</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> $contextSharedApp;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> \Illuminate\Foundation\Application</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">createApplication</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $app = <span class="keyword">require</span> <span class="keyword">__DIR__</span> . <span class="string">'/../../bootstrap/app.php'</span>;</span><br><span class="line"></span><br><span class="line">        $app-&gt;loadEnvironmentFrom(<span class="keyword">self</span>::ENV_FILE);</span><br><span class="line"></span><br><span class="line">        $app-&gt;make(Kernel::class)-&gt;bootstrap();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $app;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@BeforeScenario</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">before</span><span class="params">()</span>: <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">static</span>::$contextSharedApp) &#123;</span><br><span class="line">            <span class="keyword">parent</span>::setUp();</span><br><span class="line">            <span class="keyword">static</span>::$contextSharedApp = <span class="keyword">$this</span>-&gt;app;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;app = <span class="keyword">static</span>::$contextSharedApp;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@AfterScenario</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">after</span><span class="params">()</span>: <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">static</span>::$contextSharedApp) &#123;</span><br><span class="line">            <span class="keyword">parent</span>::tearDown();</span><br><span class="line">            <span class="keyword">static</span>::$contextSharedApp = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>相信上面的程式碼應該很簡單，這邊就不再多做說明了。最後我一樣把範例放在 GitHub 上，請大家自行下載參考。</p>
</div><div class="tags"><a href="/tags/測試/">測試</a><a href="/tags/Laravel/">Laravel</a></div><div class="post-nav"><a class="pre" href="/my-2018/">我的 2018 年</a><a class="next" href="/behat-in-laravel/">在 Laravel 中使用 Behat 來加強測試的可讀性 - 基礎篇</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://jaceju.net"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分類</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 標籤</i></div><div class="tagcloud"><a href="/tags/Web-開發/" style="font-size: 15px;">Web 開發</a> <a href="/tags/測試/" style="font-size: 15px;">測試</a> <a href="/tags/Laravel/" style="font-size: 15px;">Laravel</a> <a href="/tags/TDD/" style="font-size: 15px;">TDD</a> <a href="/tags/心得感想/" style="font-size: 15px;">心得感想</a> <a href="/tags/PHP/" style="font-size: 15px;">PHP</a> <a href="/tags/CSS/" style="font-size: 15px;">CSS</a> <a href="/tags/ASP/" style="font-size: 15px;">ASP</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/Selenium/" style="font-size: 15px;">Selenium</a> <a href="/tags/好書推薦/" style="font-size: 15px;">好書推薦</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/設計模式/" style="font-size: 15px;">設計模式</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/程式開發/" style="font-size: 15px;">程式開發</a> <a href="/tags/伺服器安裝與設定/" style="font-size: 15px;">伺服器安裝與設定</a> <a href="/tags/Refactoring/" style="font-size: 15px;">Refactoring</a> <a href="/tags/jQuery/" style="font-size: 15px;">jQuery</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/how-i-built-my-side-project/">我如何從需求出發到完成一個專案</a></li><li class="post-list-item"><a class="post-list-link" href="/function-name-must-be-a-string-in-laravel-testing/">Laravel 執行測試時出現 Function name must be a string</a></li><li class="post-list-item"><a class="post-list-link" href="/what-is-essential-to-frontend-engineers/">身為前端工程師，對你來說，你認為最重要的是什麼？</a></li><li class="post-list-item"><a class="post-list-link" href="/my-2018/">我的 2018 年</a></li><li class="post-list-item"><a class="post-list-link" href="/behat-in-laravel-advance/">在 Laravel 中使用 Behat 來加強測試的可讀性 - 進階篇</a></li><li class="post-list-item"><a class="post-list-link" href="/behat-in-laravel/">在 Laravel 中使用 Behat 來加強測試的可讀性 - 基礎篇</a></li><li class="post-list-item"><a class="post-list-link" href="/composer-replace/">理解 composer.json 的 replace</a></li><li class="post-list-item"><a class="post-list-link" href="/steps-of-refactoring-or-rebuilding/">重構或重寫 Legacy code 的幾個階段</a></li><li class="post-list-item"><a class="post-list-link" href="/refactor-or-rebuild/">面對 Legacy Code ，該重構還是重寫？</a></li><li class="post-list-item"><a class="post-list-link" href="/to-test-the-detail-or-to-test-the-result/">測試該驗證結果還是該驗證細節</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友站連結</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">網站製作學習誌.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>