<!DOCTYPE html><html lang="zh-TW"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>面對 Legacy Code ，該重構還是重寫？ | 網站製作學習誌</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="面對 Legacy Code ，該重構還是重寫？"><meta name="twitter:description" content="記錄在開發網站時所學的一切"><meta name="og:title" content="面對 Legacy Code ，該重構還是重寫？"><meta name="og:site_name" content="網站製作學習誌"><meta name="og:description" content="記錄在開發網站時所學的一切"><meta name="og:type" content="article"><meta name="og:image" content=""></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">面對 Legacy Code ，該重構還是重寫？</h1><a id="logo" href="/.">網站製作學習誌</a><p class="description">記錄在開發網站時所學的一切</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首頁</i></a><a href="/archives/"><i class="fa fa-archive"> 所有文章</i></a><a href="/about/"><i class="fa fa-user"> 關於</i></a><a href="/atom.xml"><i class="fa fa-rss"> 訂閱</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">面對 Legacy Code ，該重構還是重寫？</h1><div class="post-meta">May 9, 2018</div><div class="post-content"><p>在程式已經上線很久很久的情況下，公司也找了不少人來維護這些程式碼；而因為開發者來來去去，加上每個人對程式開發的觀念不同，他們也許都有過這樣的感受：</p>
<ul>
<li>因為缺少規格文件，這團程式碼到底有哪些是該拔還是不該拔，很抖；算了，放著不管吧。</li>
<li>因為迫於時間壓力，被只求解決眼前問題所帶來的不穩定性困擾著；算了，有 bug 再修。</li>
<li>因為沒有寫過測試，修正程式時常常擔心改東壞西的不安全感；算了，有人叫再說。</li>
<li>因為團隊已有慣例，想要動手調整架構，卻怕同事不支持；算了，給下個人弄吧。</li>
<li>因為依賴語言特性，有些好的作法引入之後反而造成問題；算了，反正會動就好。</li>
</ul>
<p>結果專案中的技術債越欠越多，而這些程式碼也變成了所謂的 legacy code 。</p>
<a id="more"></a>
<p>在維護這樣的 legacy code 時，我想很多開發者應該都思考過這個問題：「我到底應該要重構還是重寫？」老實說我的答案就是 “It depends” 。</p>
<p>重構與重寫沒有哪種方法一定比較好，不過在選擇之前，我還是得先把重構和重寫的不同說明清楚。</p>
<h2 id="重構不是你想的那樣"><a href="#重構不是你想的那樣" class="headerlink" title="重構不是你想的那樣"></a>重構不是你想的那樣</h2><p>不過很多人對「重構」這個詞有所誤解，以為它是在功能完成後大幅度地修改原有的程式碼；放在 legacy code 上時，大概就會認為是「架構設計翻新」這種程度的修改。</p>
<p>事實上重構的粒度是非常小的，它並不是整個專案做完之後才開始，而是開發功能的過程中就一小步一小步的進行。重構的時間點不要離寫完程式碼的時間點太遠，像是在完成一小部份的功能後就立刻回頭看看是否能讓程式碼更結構化，或是在每次開始新功能先思考既有結構是否影響了新功能的加入；然後針對這些部份進行微調，所以重構佔的是開發一小部份的時間。</p>
<p>會提出要重構 legacy code 的人，多數是希望不要花太多力氣去撰寫新的程式碼，而是重用已經存在的邏輯；畢竟已上線運作的舊有程式碼，比起那些沒經過時間驗證過的新寫程式碼來得可靠數百倍。只是如果想重用這些既有邏輯有兩個前提：一、它們易於理解且有組織化；二、有自動化測試。不過令人苦惱的是：大多數 legacy code 都很難達成這兩個要求。</p>
<p>但假設這兩個前提達到的情況下，進行大粒度的重構也不是不可能，但還是有些工作得先進行。</p>
<h2 id="重寫也不是你想的那樣"><a href="#重寫也不是你想的那樣" class="headerlink" title="重寫也不是你想的那樣"></a>重寫也不是你想的那樣</h2><p>那麼重寫整個專案呢？重寫聽起來是擺脫一些舊包袱的好方法，似乎這樣就可以不用再去理會那些 legacy code 了。所以就可能會有些剛到公司幾個月的新人，會在看不慣前人寫的程式碼時就提出了重寫的建議，只不過事情通常不會是像他們想得這麼簡單。</p>
<p>很多 legacy code 問題都不是技術的問題，而是它已經創造出一個每個人都依賴著它的世界，所有相關人士與現存系統對規則的認知都是基於這些 legacy code ；因此一旦你決定真的要重寫整個專案，你必須有相當的自信去說服所有關係人，並爭取到上頭的支持；最好能提出一份可行的 roadmap ，來讓大家能夠審視你的想法。再來也要考慮到公司是否對這個專案有其他預定中的計劃，有沒有時間讓你重寫。</p>
<p>重寫最重要的一點，是你夠不夠清楚這個系統現行的規格。當你真的可以重寫時，你必須邀請 PM 或熟悉這個系統來龍去脈的人員來協助你瞭解整個舊有系統。很多失敗的重寫，就是因為不夠瞭解原有的系統規則，不清楚為什麼前人針對某些情境撰寫 workaround ，結果在新專案上線時因為少做了某些細部功能而使得整個服務大爆炸。所以當你想大刀闊斧地砍掉重寫，就得想辦法把所有規則都涵蓋到；而這件事本身就是曠日費時，你不可能馬上完成，所以還是必須顧好現行的 legacy code 。</p>
<p>這使得重寫有個很明顯的劣勢：當關係人打算在服務新增功能時，你可能要在舊專案和新專案上同時進行。所以一般重寫時都會請 PM 凍結需求，讓新專案上線後再繼續實作這些新功能；只是這時候你就得跟時間賽跑，如果你家 PM 人很好的話會幫你擋需求，只是他擋得了一時，擋不了一世。</p>
<h2 id="所以我到底該選哪條路？"><a href="#所以我到底該選哪條路？" class="headerlink" title="所以我到底該選哪條路？"></a>所以我到底該選哪條路？</h2><p>假設不論是重構或是重寫，公司都給時間了，我們該怎麼選擇呢？雖然說是 “It depends” ，但總應該有些判斷的原則吧？這邊我簡單整理重構時要著重的幾個要點：</p>
<ol>
<li>專案本身已經有整理好相關文件，同時也有自動化測試。</li>
<li>專案本身只是部份程式體質不佳，整體來說還算好理解。</li>
<li>專案影響到的關係人太多，無法輕易凍結需求。</li>
</ol>
<p>符合上述特點的專案，你可以考慮用重構，一點一點地來將它的體質調整好。</p>
<p>那麼什麼時候要考慮重寫？</p>
<ol>
<li>改個幾行程式碼就得花很多成本來手動測試。</li>
<li>專案用的技術已經沒人改得動它了，或是新的系統環境不支援。</li>
<li>現行的技術或是你的能力可能可以更快地實現同樣的系統。</li>
<li>沒人知道某些功能還有沒有用，文件也早就遺失了。</li>
</ol>
<p>當然以上列的這些要點不見得有全面的考量，重要的還是要看大家所面對的專案狀況來決定。簡單來說，當 legacy code 的複雜度已經高到你難以維護，每次修改都要耗費大量時間與人力去驗證時，也許就是重寫的契機；在這之前，你還是應該以重構為優先。</p>
<p>不論是重構或重寫，都一定要瞭解這兩者對公司所產生的衝擊，這樣才能找出影響最小的方式來讓 legacy project 煥然一新。</p>
<p>下一篇，我來聊聊一些我在<a href="/steps-of-refactoring-or-rebuilding">重構或重寫時的經驗與心得</a>。</p>
</div><div class="tags"><a href="/tags/心得感想/">心得感想</a><a href="/tags/程式開發/">程式開發</a><a href="/tags/Refactoring/">Refactoring</a></div><div class="post-nav"><a class="pre" href="/steps-of-refactoring-or-rebuilding/">重構或重寫 Legacy code 的幾個階段</a><a class="next" href="/to-test-the-detail-or-to-test-the-result/">測試該驗證結果還是該驗證細節</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://jaceju.net"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分類</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 標籤</i></div><div class="tagcloud"><a href="/tags/好書推薦/" style="font-size: 15px;">好書推薦</a> <a href="/tags/測試/" style="font-size: 15px;">測試</a> <a href="/tags/TDD/" style="font-size: 15px;">TDD</a> <a href="/tags/Laravel/" style="font-size: 15px;">Laravel</a> <a href="/tags/心得感想/" style="font-size: 15px;">心得感想</a> <a href="/tags/PHP/" style="font-size: 15px;">PHP</a> <a href="/tags/CSS/" style="font-size: 15px;">CSS</a> <a href="/tags/ASP/" style="font-size: 15px;">ASP</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/Web-開發/" style="font-size: 15px;">Web 開發</a> <a href="/tags/Selenium/" style="font-size: 15px;">Selenium</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/設計模式/" style="font-size: 15px;">設計模式</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/程式開發/" style="font-size: 15px;">程式開發</a> <a href="/tags/伺服器安裝與設定/" style="font-size: 15px;">伺服器安裝與設定</a> <a href="/tags/Refactoring/" style="font-size: 15px;">Refactoring</a> <a href="/tags/Vue/" style="font-size: 15px;">Vue</a> <a href="/tags/讀書心得/" style="font-size: 15px;">讀書心得</a> <a href="/tags/jQuery/" style="font-size: 15px;">jQuery</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/review-reengineering-legacy-software/">《遺留系統重建實戰》導讀與心得</a></li><li class="post-list-item"><a class="post-list-link" href="/integrate-vue-cli-into-laravel/">在 Laravel 專案中整合 Vue CLI</a></li><li class="post-list-item"><a class="post-list-link" href="/how-i-built-my-side-project/">我如何從需求出發到完成一個專案</a></li><li class="post-list-item"><a class="post-list-link" href="/function-name-must-be-a-string-in-laravel-testing/">Laravel 執行測試時出現 Function name must be a string</a></li><li class="post-list-item"><a class="post-list-link" href="/what-is-essential-to-frontend-engineers/">身為前端工程師，對你來說，你認為最重要的是什麼？</a></li><li class="post-list-item"><a class="post-list-link" href="/my-2018/">我的 2018 年</a></li><li class="post-list-item"><a class="post-list-link" href="/behat-in-laravel-advance/">在 Laravel 中使用 Behat 來加強測試的可讀性 - 進階篇</a></li><li class="post-list-item"><a class="post-list-link" href="/behat-in-laravel/">在 Laravel 中使用 Behat 來加強測試的可讀性 - 基礎篇</a></li><li class="post-list-item"><a class="post-list-link" href="/composer-replace/">理解 composer.json 的 replace</a></li><li class="post-list-item"><a class="post-list-link" href="/steps-of-refactoring-or-rebuilding/">重構或重寫 Legacy code 的幾個階段</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友站連結</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">網站製作學習誌.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>