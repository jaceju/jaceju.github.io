<!DOCTYPE html><html lang="zh-TW"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>[五分鐘教室] 重構多參數函式 | 網站製作學習誌</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">[五分鐘教室] 重構多參數函式</h1><a id="logo" href="/.">網站製作學習誌</a><p class="description">記錄在開發網站時所學的一切</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首頁</i></a><a href="/archives/"><i class="fa fa-archive"> 所有文章</i></a><a href="/about/"><i class="fa fa-user"> 關於</i></a><a href="/atom.xml"><i class="fa fa-rss"> 訂閱</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">[五分鐘教室] 重構多參數函式</h1><div class="post-meta">Dec 16, 2009</div><div class="post-content"><p>我們在撰寫 PHP 函式 (或類別的方法) 時，多少都會帶入一些參數，例如：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myfunc</span><span class="params">($arg1, $arg2, ...)</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>一般常見的函式，它們的參數數量大多只會兩三個，但如果有參數的數量很多時該怎麼辦？</p>
<a id="more"></a>
<h2 id="多參數的困擾"><a href="#多參數的困擾" class="headerlink" title="多參數的困擾"></a>多參數的困擾</h2><p>當一個 PHP 函式的參數多於三個以上時，其實就會浮現一些讓程式開發人員困擾的問題。</p>
<h3 id="順序不易記憶"><a href="#順序不易記憶" class="headerlink" title="順序不易記憶"></a>順序不易記憶</h3><p>當函式名稱語意不明時，加上如果沒有 IDE 的協助，你會很難瞭解參數的先後順序。</p>
<p>像我自己就很常搞錯 <code>iconv</code> 的參數順序：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">iconv($in_charset, $out_charset, $str)</span><br></pre></td></tr></table></figure>
<p>每次使用時，我都要回去看看官方手冊，才會記得第一個參數是輸入編碼而不是要轉換的字串。</p>
<h3 id="預設值"><a href="#預設值" class="headerlink" title="預設值"></a>預設值</h3><p>還有一個狀況是參數如果有預設值時，一定是將它放在最右邊的參數。例如 <code>htmlspecialchars</code> 這個函式：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">htmlspecialchars($string[, $quote_style = ENT_COMPAT[, $charset = <span class="string">'ISO-8859-1'</span>[, $double_encode = <span class="keyword">true</span>]]])</span><br></pre></td></tr></table></figure>
<p>如果今天我們只想要載入第一個參數 (要轉換的字串) 和第三個參數 (編碼) ，這是做不到的；我們不得不把第二個參數 (引號型態) 也一併代入，即便我們不想更改它的預設值。</p>
<h2 id="解決方式"><a href="#解決方式" class="headerlink" title="解決方式"></a>解決方式</h2><p>我們可以用關聯式陣列來解決前述的問題，也就是把多個參數變成一個陣列。</p>
<p>例如以前面的 <code>iconv</code> 為例，我們自己定義了一個函式將它包裝起來，然後把原來的三個參數變成一個參數陣列：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定義</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">my_iconv</span><span class="params">($options)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> iconv($options[<span class="string">'inputCharset'</span>], $options[<span class="string">'outputCharset'</span>], $options[<span class="string">'convertString'</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//用法</span></span><br><span class="line"><span class="keyword">echo</span> my_iconv(<span class="keyword">array</span>(</span><br><span class="line">    <span class="string">'convertString'</span> =&gt; <span class="string">'test'</span>,</span><br><span class="line">    <span class="string">'inputCharset'</span> =&gt; <span class="string">'BIG5'</span>,</span><br><span class="line">    <span class="string">'outputCharset'</span> =&gt; <span class="string">'UTF-8'</span>,</span><br><span class="line">));</span><br></pre></td></tr></table></figure>
<p>這樣一來，不僅我們不用擔心參數順序的問題，還可以很容易地分辨出每個參數值所代表的意義。</p>
<p>註：這種作法在一些 JavaScript Library 裡也常見到，像是 jQuery 很多方法都是以物件來當做參數組代入。</p>
<h3 id="考慮預設值"><a href="#考慮預設值" class="headerlink" title="考慮預設值"></a>考慮預設值</h3><p>那麼如果參數需要預設值時該怎麼做呢？這時候我們可以在函式裡預先放置一個含有預設值的陣列，來跟使用者傳入的陣列做合併的動作。例如：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">my_htmlspecialchars</span><span class="params">($str, $options = array<span class="params">()</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $options = (<span class="keyword">array</span>) $options;</span><br><span class="line">    $options += <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">'quoteStyle'</span> =&gt; ENT_COMPAT,</span><br><span class="line">        <span class="string">'charset'</span> =&gt; <span class="string">'ISO-8859-1'</span>,</span><br><span class="line">        <span class="string">'doubleEncode'</span> =&gt; <span class="keyword">true</span>,</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> htmlspecialchars(</span><br><span class="line">        $str,</span><br><span class="line">        $options[<span class="string">'quoteStyle'</span>],</span><br><span class="line">        $options[<span class="string">'charset'</span>],</span><br><span class="line">        $options[<span class="string">'doubleEncode'</span>]</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> my_htmlspecialchars(<span class="string">'&lt;test&gt;測試&lt;/test&gt;'</span>, <span class="keyword">array</span>(<span class="string">'charset'</span> =&gt; <span class="string">'UTF-8'</span>));</span><br></pre></td></tr></table></figure>
<p>這裡我用了「 <code>+</code> 」這個可以用來合併陣列的操作符，它會以左邊陣列裡的值為主，然後將右邊的值合併進來。</p>
<p>這樣一來，右邊的陣列裡我們可以放置預設的參數值，而不必擔心使用者沒有帶入中間必要的參數。</p>
<p>註：你也許會發現我沒有把 <code>$str</code> 放到 <code>$options</code> 裡，這是因為它本身就是必要的參數。</p>
<h3 id="缺點"><a href="#缺點" class="headerlink" title="缺點"></a>缺點</h3><p>使用關聯式陣列當做參數值也不能說完全沒有缺點，實際應用上我就發現了以下幾個問題：</p>
<ul>
<li><p>比原本的程式寫法囉嗦了些，你得多打好多字才能達到相同的目的。</p>
</li>
<li><p>參數名稱不易記憶，且預設值要寫在註解裡，而不是寫在定義裡；這樣一來有些 IDE 如果不顯示函式註解的話，還是得看手冊才能知道這些參數的名稱與預設值。</p>
</li>
</ul>
<h2 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h2><p>用關聯式陣列來取代多參數這個方法，最大的好處就是當後續維護的開發人員，可以不必再回頭查看手冊，一眼就能知道每個參數值所代表的意義。</p>
<p>不過這個方法還是得看狀況使用，因為它所帶來的缺點可能會讓很多開發人員覺得很不便。所以在設計函式時，一定要仔細思考如何去定義才能讓開發者方便使用這些它們。</p>
</div><div class="tags"><a href="/tags/PHP/">PHP</a></div><div class="post-nav"><a class="pre" href="/familiar-patterns/">[Web] 常見設計模式介紹</a><a class="next" href="/mysql-character-set/">[五分鐘教室] MySQL 4.1+ 編碼快速入門</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://jaceju.net"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分類</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 標籤</i></div><div class="tagcloud"><a href="/tags/Web-開發/" style="font-size: 15px;">Web 開發</a> <a href="/tags/測試/" style="font-size: 15px;">測試</a> <a href="/tags/Laravel/" style="font-size: 15px;">Laravel</a> <a href="/tags/TDD/" style="font-size: 15px;">TDD</a> <a href="/tags/心得感想/" style="font-size: 15px;">心得感想</a> <a href="/tags/PHP/" style="font-size: 15px;">PHP</a> <a href="/tags/CSS/" style="font-size: 15px;">CSS</a> <a href="/tags/ASP/" style="font-size: 15px;">ASP</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/Selenium/" style="font-size: 15px;">Selenium</a> <a href="/tags/好書推薦/" style="font-size: 15px;">好書推薦</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/設計模式/" style="font-size: 15px;">設計模式</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/程式開發/" style="font-size: 15px;">程式開發</a> <a href="/tags/伺服器安裝與設定/" style="font-size: 15px;">伺服器安裝與設定</a> <a href="/tags/Refactoring/" style="font-size: 15px;">Refactoring</a> <a href="/tags/jQuery/" style="font-size: 15px;">jQuery</a> <a href="/tags/Zend-Framework/" style="font-size: 15px;">Zend Framework</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/function-name-must-be-a-string-in-laravel-testing/">Laravel 執行測試時出現 Function name must be a string</a></li><li class="post-list-item"><a class="post-list-link" href="/what-is-essential-to-frontend-engineers/">身為前端工程師，對你來說，你認為最重要的是什麼？</a></li><li class="post-list-item"><a class="post-list-link" href="/my-2018/">我的 2018 年</a></li><li class="post-list-item"><a class="post-list-link" href="/behat-in-laravel-advance/">在 Laravel 中使用 Behat 來加強測試的可讀性 - 進階篇</a></li><li class="post-list-item"><a class="post-list-link" href="/behat-in-laravel/">在 Laravel 中使用 Behat 來加強測試的可讀性 - 基礎篇</a></li><li class="post-list-item"><a class="post-list-link" href="/composer-replace/">理解 composer.json 的 replace</a></li><li class="post-list-item"><a class="post-list-link" href="/steps-of-refactoring-or-rebuilding/">重構或重寫 Legacy code 的幾個階段</a></li><li class="post-list-item"><a class="post-list-link" href="/refactor-or-rebuild/">面對 Legacy Code ，該重構還是重寫？</a></li><li class="post-list-item"><a class="post-list-link" href="/to-test-the-detail-or-to-test-the-result/">測試該驗證結果還是該驗證細節</a></li><li class="post-list-item"><a class="post-list-link" href="/php-quality-analysis/">分析 PHP 程式碼品質</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友站連結</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">網站製作學習誌.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>