<!DOCTYPE html><html lang="zh-TW"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>關於 PHP Traversing 的這檔事 | 網站製作學習誌</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="關於 PHP Traversing 的這檔事"><meta name="twitter:description" content="記錄在開發網站時所學的一切"><meta name="og:title" content="關於 PHP Traversing 的這檔事"><meta name="og:site_name" content="網站製作學習誌"><meta name="og:description" content="記錄在開發網站時所學的一切"><meta name="og:type" content="article"><meta name="og:image" content></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">關於 PHP Traversing 的這檔事</h1><a id="logo" href="/.">網站製作學習誌</a><p class="description">記錄在開發網站時所學的一切</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首頁</i></a><a href="/archives/"><i class="fa fa-archive"> 所有文章</i></a><a href="/about/"><i class="fa fa-user"> 關於</i></a><a href="/atom.xml"><i class="fa fa-rss"> 訂閱</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">關於 PHP Traversing 的這檔事</h1><div class="post-meta">Dec 24, 2019</div><div class="post-content"><p><code>foreach</code> 大概是 PHP 程式中最常見的語法結構之後，本文將會介紹 <code>foreach</code> 的一些觀念，以及幾個跟它相關的 PHP 7 特色。</p>
<a id="more"></a>

<h2 id="foreach-起手式"><a href="#foreach-起手式" class="headerlink" title="foreach 起手式"></a>foreach 起手式</h2><h3 id="常見的-foreach-用法"><a href="#常見的-foreach-用法" class="headerlink" title="常見的 foreach 用法"></a>常見的 foreach 用法</h3><p>一般我們最常看到 <a href="https://www.php.net/manual/en/control-structures.foreach.php" target="_blank" rel="noopener"><code>foreach</code></a> 用在遍歷 (traversing) 陣列裡的元素，例如：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> ($arr <span class="keyword">as</span> $num) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"$num\n"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>而如果想遍歷關連式陣列 (associative array) ，同時取得元素的鍵 (key) 與值 (value) ，可以用以下語法：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$arr = [<span class="string">'a'</span> =&gt; <span class="number">1</span>, <span class="string">'b'</span> =&gt; <span class="number">2</span>, <span class="string">'c'</span> =&gt; <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> ($arr <span class="keyword">as</span> $key =&gt; $num) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"$key =&gt; $num\n"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果陣列元素本身也是陣列，我們稱為「巢狀陣列 (nested array) 」。在遍歷巢狀陣列時，我們可以用 <code>list(...)</code> 來解構每個陣列元素：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$arr = [</span><br><span class="line">    [<span class="string">'a'</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="string">'b'</span>, <span class="number">2</span>],</span><br><span class="line">    [<span class="string">'c'</span>, <span class="number">3</span>],</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> ($arr <span class="keyword">as</span> <span class="keyword">list</span>($alpha, $num)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"$alpha =&gt; $num\n"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 PHP 7.1 之後，你可以用方括號來取代 <code>list()</code> ：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">foreach</span> ($arr <span class="keyword">as</span> [$alpha, $num]) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"$alpha =&gt; $num\n"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>當然別忘了 PHP 7.1 之後， <code>list()</code> 可以用指定鍵的方式來取值：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$users = [</span><br><span class="line">    [<span class="string">'id'</span> =&gt; <span class="number">1</span>, <span class="string">'name'</span> =&gt; <span class="string">'Alice'</span>, <span class="string">'age'</span> =&gt; <span class="number">18</span>],</span><br><span class="line">    [<span class="string">'id'</span> =&gt; <span class="number">2</span>, <span class="string">'name'</span> =&gt; <span class="string">'Bob'</span>, <span class="string">'age'</span> =&gt; <span class="number">24</span>],</span><br><span class="line">    [<span class="string">'id'</span> =&gt; <span class="number">3</span>, <span class="string">'name'</span> =&gt; <span class="string">'Carl'</span>, <span class="string">'age'</span> =&gt; <span class="number">33</span>]</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> ($users <span class="keyword">as</span> [<span class="string">'name'</span> =&gt; $name, <span class="string">'age'</span> =&gt; $age, <span class="string">'id'</span> =&gt; $id]) &#123;</span><br><span class="line">    var_dump(<span class="string">"$id $name: $age"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如果沒有-foreach"><a href="#如果沒有-foreach" class="headerlink" title="如果沒有 foreach"></a>如果沒有 foreach</h3><p>PHP 有提供幾個函式用來操作陣列裡的指標，以及取得指標指向的陣列元素；分別是 <a href="https://www.php.net/manual/en/function.reset.php" target="_blank" rel="noopener"><code>reset</code></a> / <a href="https://www.php.net/manual/en/function.prev.php" target="_blank" rel="noopener"><code>prev</code></a> / <a href="https://www.php.net/manual/en/function.next.php" target="_blank" rel="noopener"><code>next</code></a> / <a href="https://www.php.net/manual/en/function.current.php" target="_blank" rel="noopener"><code>current</code></a> / <a href="https://www.php.net/manual/en/function.end.php" target="_blank" rel="noopener"><code>end</code></a> 。</p>
<p>你可以用 <a href="https://www.php.net/manual/en/control-structures.while.php" target="_blank" rel="noopener"><code>while</code></a> 搭配以上的函式來遍歷陣列：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$arr = [<span class="keyword">null</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="keyword">false</span>, <span class="keyword">null</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接找到最後一個元素</span></span><br><span class="line"><span class="comment">// 這裡指標是指向最後一個元素</span></span><br><span class="line">var_dump(end($arr));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 因為指標已經跑到最後一個元素的位置</span></span><br><span class="line"><span class="comment">// 所以要重置指標</span></span><br><span class="line">reset($arr);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍歷陣列裡的元素</span></span><br><span class="line"><span class="keyword">while</span> (!is_null(key($arr))) &#123;</span><br><span class="line">    var_dump(current($arr));</span><br><span class="line">    next($arr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指標的位置已經沒有元素了</span></span><br><span class="line">var_dump(current($arr));</span><br></pre></td></tr></table></figure>

<p>另一個不用 <code>foreach</code> 的方法是使用 <code>array_walk</code> 這個函式：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">array_walk($arr, <span class="function"><span class="keyword">function</span> <span class="params">($item)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"$item "</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$arr = [<span class="string">'a'</span> =&gt; <span class="number">1</span>, <span class="string">'b'</span> =&gt; <span class="number">2</span>, <span class="string">'c'</span> =&gt; <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">array_walk($arr, <span class="function"><span class="keyword">function</span> <span class="params">($item, $key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"$key =&gt; $item"</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="用-foreach-來列舉物件屬性"><a href="#用-foreach-來列舉物件屬性" class="headerlink" title="用 foreach 來列舉物件屬性"></a>用 foreach 來列舉物件屬性</h3><p><code>foreach</code> 也可以用來列舉 (listing) 物件的屬性，只要該物件不是屬於可遍歷的物件。</p>
<p>當你對一個物件實體用 <code>foreach</code> 來列舉屬性的話，你只能看到它的公開屬性：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $publicVar = <span class="string">'public var'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $protectedVar = <span class="string">'protected var'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> $privateVar = <span class="string">'private var'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$class = <span class="keyword">new</span> MyClass();</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> ($class <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"$key =&gt; $value\n"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是如果你是在物件內部對 <code>$this</code> 做列舉屬性，那麼你可以看到這個物件所有的屬性：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $publicVar = <span class="string">'public var'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $protectedVar = <span class="string">'protected var'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> $privateVar = <span class="string">'private var'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">iterateSelf</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">$this</span> <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"$key =&gt; $value\n"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$class = <span class="keyword">new</span> MyClass();</span><br><span class="line"></span><br><span class="line">$class-&gt;iterateSelf();</span><br></pre></td></tr></table></figure>

<p>注意，之所以特意用「列舉屬性」將「遍歷元素」的概念區分開來，實在是因為 <code>foreach</code> 對 PHP 物件的操作真的很微妙。</p>
<p>一般來說，我們希望用 <code>foreach</code> 來遍歷集合的元素，而不是列舉物件的屬性；所以當物件屬於一個集合時，就需要讓物件所屬的類別實作一些特別的介面。</p>
<h2 id="用-foreach-來遍歷的介面"><a href="#用-foreach-來遍歷的介面" class="headerlink" title="用 foreach 來遍歷的介面"></a>用 foreach 來遍歷的介面</h2><h3 id="Traversable"><a href="#Traversable" class="headerlink" title="Traversable"></a>Traversable</h3><p>如果你需要的是一個可以被遍歷的物件 (通常是集合物件) ，那麼你可以檢查它是不是屬於 <code>Traversable</code> 這個介面。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> ($obj <span class="keyword">instanceof</span> Traversalbe) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是要注意 <code>Traversable</code> 的幾個特點：</p>
<ol>
<li>類別不能直接實作 <code>Traversable</code> 介面。</li>
<li>雖然陣列可以用 <code>foreach</code> 來遍歷，但它並不屬於 <code>Traversable</code> 介面。</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 不能直接實作</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyExample</span> <span class="keyword">implements</span> <span class="title">Traversable</span> </span>&#123;&#125; <span class="comment">// Error</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 陣列不屬於 Traversable</span></span><br><span class="line">$arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">var_dump($arr <span class="keyword">instanceof</span> Traversable); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<p>再次強調：物件雖然可以用 <code>foreach</code> 來操作，但它不一定是 <code>Traversable</code> 。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 物件可以 foreach 列舉屬性，但不一定是 Traversable</span></span><br><span class="line">$obj = (object) [<span class="string">'a'</span> =&gt; <span class="number">1</span>, <span class="string">'b'</span> =&gt; <span class="number">2</span>, <span class="string">'c'</span> =&gt; <span class="number">3</span>];</span><br><span class="line"><span class="keyword">foreach</span> ($obj <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"$key =&gt; $value\n"</span>;</span><br><span class="line">&#125;</span><br><span class="line">var_dump($obj <span class="keyword">instanceof</span> Traversable); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyExample</span> </span>&#123;&#125;</span><br><span class="line">$obj = <span class="keyword">new</span> MyExample();</span><br><span class="line">var_dump($obj <span class="keyword">instanceof</span> Traversable); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<h3 id="Iterator-與-IteratorAggregate"><a href="#Iterator-與-IteratorAggregate" class="headerlink" title="Iterator 與 IteratorAggregate"></a>Iterator 與 IteratorAggregate</h3><p>由於不能直接實作 <code>Traversable</code> 介面，官方建議應該改為實作 <code>Iterator</code> 或是 <code>IteratorAggregate</code> 這類的介面，它們都繼承自 <code>Traversable</code> 介面。</p>
<p><code>Iterator</code> 介面就如同前面介紹的 <code>next</code> 、 <code>current</code> 等函式一樣，提供了操作指標與取得指標所指向的元素等方法介面，以供類別來實作。</p>
<p>以下是一個很典型的範例：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IteratorExample</span> <span class="keyword">implements</span> <span class="title">Iterator</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $position = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> $data = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(array $data)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;position = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;data = $data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">rewind</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;position = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">current</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;data[<span class="keyword">$this</span>-&gt;position];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">key</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;position;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">next</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ++<span class="keyword">$this</span>-&gt;position;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">valid</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> array_key_exists(</span><br><span class="line">            <span class="keyword">$this</span>-&gt;position,</span><br><span class="line">            <span class="keyword">$this</span>-&gt;data</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我們可以用 <code>while</code> 敘述來遍歷 <code>Iterator</code> 物件裡的元素：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$it = <span class="keyword">new</span> IteratorExample([<span class="string">'a'</span>, <span class="keyword">null</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]);</span><br><span class="line"></span><br><span class="line">$it-&gt;rewind();</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> ($it-&gt;valid()) &#123;</span><br><span class="line">    $key = $it-&gt;key();</span><br><span class="line">    var_dump($it-&gt;current());</span><br><span class="line">    $it-&gt;next();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>當然也可以用 <code>foreach</code> 來遍歷，因為這時所生成的物件實體已經屬於 <code>Traveralbe</code> 介面了：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">foreach</span> ($it <span class="keyword">as</span> $value) &#123;</span><br><span class="line">    var_dump($value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var_dump($it <span class="keyword">instanceof</span> Traversable); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>實作 <code>Iterator</code> 介面的好處，就是可以依照自定義的邏輯來遍歷物件內的元素，這在某些特別的情境下很好用。</p>
<p>另一個更為簡便的介面是 <code>IteratorAggregate</code> ，它只需要實作 <code>getIterator</code> 這個方法就可以了， <code>getIterator</code> 方法必須回傳一個實作 <code>Iterator</code> 的物件。</p>
<p>PHP 內建了<a href="https://www.php.net/manual/en/spl.iterators.php" target="_blank" rel="noopener">多種 Iterator 類別</a>讓開發者不需要從頭定義一個實作 <code>Iterator</code> 介面的類別，以下示範 <code>ArrayIterator</code> 這個類別如何跟 <code>IteratorAggregate</code> 介面搭配：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IteratorAggregateExample</span> <span class="keyword">implements</span> <span class="title">IteratorAggregate</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $data = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(array $data)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;data = $data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getIterator</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ArrayIterator(<span class="keyword">$this</span>-&gt;data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$it = <span class="keyword">new</span> IteratorAggregateExample([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> ($it <span class="keyword">as</span> $value) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"$value\n"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用 <code>IteratorAggregate</code> 介面的好處是，你可以動態更換 <code>getIterator</code> 方法的回傳內容，而不必讓程式綁死在特定的 Iterator 類別上。</p>
<h3 id="iterable-型別"><a href="#iterable-型別" class="headerlink" title="iterable 型別"></a>iterable 型別</h3><p><code>Traversable</code> 雖然可以用來判斷變數可否被遍歷，但它卻不適用在陣列變數上。因此 PHP 在 7.1 加入了一個偽型別 (pseudo-type) ： <a href="https://www.php.net/manual/en/language.types.iterable.php" target="_blank" rel="noopener"><code>iterable</code></a> ，可以用在 <a href="https://www.php.net/manual/en/functions.arguments.php#functions.arguments.type-declaration" target="_blank" rel="noopener">Argument type declarations</a> (即 type hint) 及 <a href="https://www.php.net/manual/en/functions.returning-values.php#functions.returning-values.type-declaration" target="_blank" rel="noopener">Return type declarations</a> 上。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getArr</span><span class="params">()</span>: <span class="title">iterable</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="string">'a'</span> =&gt; <span class="number">1</span>, <span class="string">'b'</span> =&gt; <span class="number">2</span>, <span class="string">'c'</span> =&gt; <span class="number">3</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">traverse</span><span class="params">(iterable $list)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">foreach</span> ($list <span class="keyword">as</span> $item) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"$item "</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$arr = getArr();</span><br><span class="line">$it = <span class="keyword">new</span> ArrayIterator($arr);</span><br><span class="line"></span><br><span class="line">var_dump(is_iterable($arr)); <span class="comment">// true</span></span><br><span class="line">var_dump(is_iterable($it));  <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">traverse($arr); <span class="comment">// 1 2 3</span></span><br><span class="line">traverse($it);  <span class="comment">// 1 2 3</span></span><br></pre></td></tr></table></figure>

<p>因此建議在程式中，可以用 <code>iterable</code> 型別來取代 <code>Traversable</code> 介面。</p>
<h2 id="如何在-foreach-時節省記憶體"><a href="#如何在-foreach-時節省記憶體" class="headerlink" title="如何在 foreach 時節省記憶體"></a>如何在 foreach 時節省記憶體</h2><p>有時候要遍歷的對象，在生成後可能會佔用很大的記憶體空間，這可能會造成 PHP 執行時期的記憶體不足。以 <code>range</code> 為例：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showMemUsageIf</span><span class="params">(bool $show = false)</span>: <span class="title">void</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ($show) &#123;</span><br><span class="line">        <span class="keyword">echo</span> round(memory_get_usage() / <span class="number">1024</span> / <span class="number">1024</span>, <span class="number">2</span>) . <span class="string">' MB'</span> . PHP_EOL;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">showMemUsageIf(<span class="keyword">true</span>); <span class="comment">// 15.42 MB</span></span><br><span class="line">$a = range(<span class="number">1</span>, <span class="number">1000000</span>);</span><br><span class="line"><span class="keyword">foreach</span> ($a <span class="keyword">as</span> $num) &#123; ... &#125;</span><br><span class="line">showMemUsageIf(<span class="keyword">true</span>); <span class="comment">// 47.43 MB</span></span><br></pre></td></tr></table></figure>

<p>因此在 PHP 5.5 之後的版本，提供了 <a href="https://www.php.net/manual/en/class.generator.php" target="_blank" rel="noopener">Generator</a> 這個類別，它可以協助我們在必要時才生成要處理的元素。</p>
<p>但是你不能直接用 <code>new</code> 來生成一個 <code>Generator</code> 類別的物件實體，取而代之的是 PHP 提供了 <code>yield</code> 這個新語法。</p>
<p><code>yield</code> 用途和 <code>return</code> 很類似，但 <code>yield</code> 只能放在函式或類別方法中，而包含了 <code>yield</code> 的函式或類別方法，其回傳值的型態都是 <code>Generator</code> 類別。</p>
<p>由於 <code>Generator</code> 類別實作了 <code>Iterator</code> 介面，所以可以用 <code>foreach</code> 來遍歷其物件實體。</p>
<p>先來看一個基本的 <code>yield</code> 用法：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">gen</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"a: "</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"b: "</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"c: "</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 當然也可以放在迴圈裡</span></span><br><span class="line">    <span class="keyword">foreach</span> ([<span class="string">'d'</span> =&gt; <span class="number">4</span>, <span class="string">'e'</span> =&gt; <span class="number">5</span>] <span class="keyword">as</span> $key =&gt; $num) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"$key: "</span>;</span><br><span class="line">        <span class="keyword">yield</span> $num;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (gen() <span class="keyword">as</span> $num) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"$num "</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到當執行 <code>foreach</code> 的第一輪時， <code>gen()</code> 函式並不是一次跑完，而是會停在第一個 <code>yield</code> 上，並回傳 <code>yield</code> 後面的值。而第二輪則是從第一個 <code>yield</code> 後繼續執行，然後停在第二個 <code>yield</code> 。</p>
<p>由此可以看出，每當執行到 <code>yield</code> 時， <code>Generator</code> 就會保留目前的執行位置，並給出當下 <code>yield</code> 的結果，這在處理大量資料時就顯得非常有用了。</p>
<p>所以我們用 <code>Generator</code> 來重寫 <code>range</code> ，這個新函式我們命名為 <code>xrange</code> ：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">xrange</span><span class="params">($start, $limit, $step = <span class="number">1</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ($start &lt; $limit) &#123;</span><br><span class="line">        <span class="keyword">if</span> ($step &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> LogicException(<span class="string">'Step must be +ve'</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> ($i = $start; $i &lt;= $limit; $i += $step) &#123;</span><br><span class="line">            <span class="keyword">yield</span> $i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ($step &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> LogicException(<span class="string">'Step must be -ve'</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> ($i = $start; $i &gt;= $limit; $i += $step) &#123;</span><br><span class="line">            <span class="keyword">yield</span> $i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">showMemUsageIf(<span class="keyword">true</span>); <span class="comment">// 15.42 MB</span></span><br><span class="line">$a = xrange(<span class="number">1</span>, <span class="number">1000000</span>);</span><br><span class="line"><span class="keyword">foreach</span> ($a <span class="keyword">as</span> $num) &#123; ... &#125;</span><br><span class="line">showMemUsageIf(<span class="keyword">true</span>); <span class="comment">// 15.42 MB</span></span><br></pre></td></tr></table></figure>

<p>可以看到改用 <code>Generator</code> 後，記憶體的用量幾乎沒有什麼改變。</p>
<p>再舉一個例子，例如我們想要處理一個超大的 log 文字檔：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readLog</span><span class="params">(string $file)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $f = fopen($file, <span class="string">'r'</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> ($line = fgets($f)) &#123;</span><br><span class="line">            <span class="keyword">yield</span> $line;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        fclose($f);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (readLog(<span class="string">"access.log"</span>) <span class="keyword">as</span> $line) &#123;</span><br><span class="line">    <span class="comment">// echo $line;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>透過這個方式，我們可以把每一行 log 的處理邏輯和讀檔邏輯分離開來，而且也不會佔用太多記憶體。</p>
<h3 id="Generator-的特異功能"><a href="#Generator-的特異功能" class="headerlink" title="Generator 的特異功能"></a>Generator 的特異功能</h3><p><code>Generator</code> 有幾個特別 <code>yield</code> 的用法，這裡特別介紹一下。</p>
<p><code>yield</code> 可以跟 <code>return</code> 一起使用，不過這時候必須用 <code>Generator::getReturn()</code> 來取得回傳值：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getValues</span><span class="params">()</span>: <span class="title">iterable</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">'value'</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'returnValue'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$values = getValues(); <span class="comment">// $values 是一個 Generator</span></span><br><span class="line"><span class="keyword">foreach</span> ($values <span class="keyword">as</span> $value) &#123;</span><br><span class="line">    var_dump($value);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> $values-&gt;getReturn(); <span class="comment">// 'returnValue'</span></span><br></pre></td></tr></table></figure>

<p><code>yield</code> 可以回傳鍵 (key) 與值 (value) ：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getMembers</span><span class="params">()</span>: <span class="title">iterable</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">'a'</span> =&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">'b'</span> =&gt; <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">'c'</span> =&gt; <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (getMembers() <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"$key: $value\n"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>巢狀的 Generator 可以用 <code>yield from</code> 來達成， <code>yield from</code> 後面要跟著一個 <code>iterable</code> 的值：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">one</span><span class="params">()</span>: <span class="title">iterable</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">two_one</span><span class="params">()</span>: <span class="title">iterable</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">yield</span> from one();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ten_to_seven</span><span class="params">()</span>: <span class="title">iterable</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">10</span>; $i &gt;= <span class="number">7</span>; $i--) &#123;</span><br><span class="line">        <span class="keyword">yield</span> $i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">count_down</span><span class="params">()</span>: <span class="title">iterable</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">yield</span> from ten_to_seven();</span><br><span class="line">    <span class="keyword">yield</span> from [<span class="number">6</span>, <span class="number">5</span>];</span><br><span class="line">    <span class="keyword">yield</span> from <span class="keyword">new</span> ArrayIterator([<span class="number">4</span>, <span class="number">3</span>]);</span><br><span class="line">    <span class="keyword">yield</span> from two_one();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (count_down() <span class="keyword">as</span> $num) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"$num "</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>當然 <code>yield</code> 也可以用來回傳匿名函式：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFunctions</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="function"><span class="keyword">function</span> <span class="params">($num)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $num;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">yield</span> <span class="function"><span class="keyword">function</span> <span class="params">($num)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $num + <span class="number">1</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">yield</span> <span class="function"><span class="keyword">function</span> <span class="params">($num)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $num + <span class="number">2</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (getFunctions() <span class="keyword">as</span> $func) &#123;</span><br><span class="line">    var_dump($func(<span class="number">1</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但以下這個例子是錯誤的，因為 anonymous function 是一個 <code>Closure</code> 物件，不能接在 <code>yield from</code> 後面：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFunctions</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">yield</span> from <span class="function"><span class="keyword">function</span> <span class="params">($num)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> ($i = <span class="number">1</span>; $i &lt;= $num; $i++) &#123;</span><br><span class="line">            <span class="keyword">yield</span> $i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (getFunctions() <span class="keyword">as</span> $func) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PHP Fatal error:  Uncaught Error: Can use "yield from" only with arrays and Traversables</span></span><br></pre></td></tr></table></figure>

<p>直接 <code>yield</code> 就可以了：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFunctions</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="function"><span class="keyword">function</span> <span class="params">($num)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> ($i = <span class="number">1</span>; $i &lt;= $num; $i++) &#123;</span><br><span class="line">            <span class="keyword">yield</span> $i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">yield</span> <span class="function"><span class="keyword">function</span> <span class="params">($num)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> ($i = $num; $i &gt;= <span class="number">1</span>; $i--) &#123;</span><br><span class="line">            <span class="keyword">yield</span> $i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (getFunctions() <span class="keyword">as</span> $func) &#123;</span><br><span class="line">    <span class="keyword">foreach</span> ($func(<span class="number">10</span>) <span class="keyword">as</span> $result) &#123;</span><br><span class="line">        var_dump($result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="在-PHPUnit-的-Data-Providers-中使用-yield"><a href="#在-PHPUnit-的-Data-Providers-中使用-yield" class="headerlink" title="在 PHPUnit 的 Data Providers 中使用 yield"></a>在 PHPUnit 的 Data Providers 中使用 yield</h2><p>在寫 PHPUnit 的測試案例時，我們通常會對某個單元的程式給出多組不同的測試資料，好驗證它的邏輯正確性；而這通常會透過 <a href="https://phpunit.readthedocs.io/en/8.5/writing-tests-for-phpunit.html#data-providers" target="_blank" rel="noopener">Data Providers</a> 這個機制來完成，例如以下這個加法測試：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">PHPUnit</span>\<span class="title">Framework</span>\<span class="title">TestCase</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DataTest</span> <span class="keyword">extends</span> <span class="title">TestCase</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@dataProvider</span> additionProvider</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> int $a</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> int $b</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> int $expected</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">testAdd</span><span class="params">(int $a, int $b, int $expected)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;assertSame($expected, $a + $b);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">additionProvider</span><span class="params">()</span>: <span class="title">iterable</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">            [<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>],</span><br><span class="line">            [<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">            [<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>],</span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在上面的測試中， <code>additionProvider</code> 這個方法就是我們的 data-provider ，它必須回傳一個陣列 (這裡稱為 data set) 的陣列；而在測試案例 <code>testAdd</code> 這個方法上，我們要加入它的註解，並用 <code>@dataProvider</code> 來宣告我們的 data-provider 是 <code>additionProvider</code> 這個方法；而 <code>additionProvider</code> 的第二層陣列的項目 (即 data set 裡的每個元素) ，就會依序代入 <code>testAdd</code> 方法參數 <code>$a</code> 、 <code>$b</code> 、 <code>$expected</code> 裡。</p>
<p>不過很多剛用 data-provider 的朋友常會忘了要包第一層的陣列，導致測試錯誤；這裡我們可以改用 <code>yield</code> 來回傳每個 data set ，好避開這類的錯誤，同時也可以讓 data-provider 更加易讀 (雖然要多打幾個 <code>yield</code> 就是了) ：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">additionProvider</span><span class="params">()</span>: <span class="title">iterable</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">yield</span> [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>];</span><br><span class="line">    <span class="keyword">yield</span> [<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">yield</span> [<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">yield</span> [<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>當然也可以用 <code>key =&gt; value</code> 的形式：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">additionProvider</span><span class="params">()</span>: <span class="title">iterable</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">'Set 1'</span> =&gt; [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>];</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">'Set 2'</span> =&gt; [<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">'Set 3'</span> =&gt; [<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">'Set 4'</span> =&gt; [<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h2><ul>
<li><a href="https://www.jianshu.com/p/86fefb0aacd9" target="_blank" rel="noopener">php 之 Generator 生成器及 yield</a></li>
<li><a href="https://learnku.com/laravel/t/8704/using-yield-to-do-memory-optimization-in-php" target="_blank" rel="noopener">在 PHP 中使用 <code>yield</code> 來做內存優化</a></li>
<li><a href="https://www.entropywins.wtf/blog/2017/10/09/yield-in-phpunit-data-providers/" target="_blank" rel="noopener">Yield in PHPUnit data providers</a></li>
</ul>
</div><div class="tags"><a href="/tags/CSS/">CSS</a></div><div class="post-nav"><a class="pre" href="/my-2019/">我的 2019 年</a><a class="next" href="/review-reengineering-legacy-software/">《遺留系統重建實戰》導讀與心得</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://jaceju.net"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分類</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 標籤</i></div><div class="tagcloud"><a href="/tags/測試/" style="font-size: 15px;">測試</a> <a href="/tags/Selenium/" style="font-size: 15px;">Selenium</a> <a href="/tags/心得感想/" style="font-size: 15px;">心得感想</a> <a href="/tags/TDD/" style="font-size: 15px;">TDD</a> <a href="/tags/PHP/" style="font-size: 15px;">PHP</a> <a href="/tags/Laravel/" style="font-size: 15px;">Laravel</a> <a href="/tags/程式開發/" style="font-size: 15px;">程式開發</a> <a href="/tags/Vue/" style="font-size: 15px;">Vue</a> <a href="/tags/CSS/" style="font-size: 15px;">CSS</a> <a href="/tags/ASP/" style="font-size: 15px;">ASP</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/Web-開發/" style="font-size: 15px;">Web 開發</a> <a href="/tags/好書推薦/" style="font-size: 15px;">好書推薦</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/jQuery/" style="font-size: 15px;">jQuery</a> <a href="/tags/設計模式/" style="font-size: 15px;">設計模式</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/Refactoring/" style="font-size: 15px;">Refactoring</a> <a href="/tags/伺服器安裝與設定/" style="font-size: 15px;">伺服器安裝與設定</a> <a href="/tags/讀書心得/" style="font-size: 15px;">讀書心得</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/my-2019/">我的 2019 年</a></li><li class="post-list-item"><a class="post-list-link" href="/all-about-php-traversing/">關於 PHP Traversing 的這檔事</a></li><li class="post-list-item"><a class="post-list-link" href="/review-reengineering-legacy-software/">《遺留系統重建實戰》導讀與心得</a></li><li class="post-list-item"><a class="post-list-link" href="/integrate-vue-cli-into-laravel/">在 Laravel 專案中整合 Vue CLI</a></li><li class="post-list-item"><a class="post-list-link" href="/how-i-built-my-side-project/">我如何從需求出發到完成一個專案</a></li><li class="post-list-item"><a class="post-list-link" href="/function-name-must-be-a-string-in-laravel-testing/">Laravel 執行測試時出現 Function name must be a string</a></li><li class="post-list-item"><a class="post-list-link" href="/what-is-essential-to-frontend-engineers/">身為前端工程師，對你來說，你認為最重要的是什麼？</a></li><li class="post-list-item"><a class="post-list-link" href="/my-2018/">我的 2018 年</a></li><li class="post-list-item"><a class="post-list-link" href="/behat-in-laravel-advance/">在 Laravel 中使用 Behat 來加強測試的可讀性 - 進階篇</a></li><li class="post-list-item"><a class="post-list-link" href="/behat-in-laravel/">在 Laravel 中使用 Behat 來加強測試的可讀性 - 基礎篇</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友站連結</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">網站製作學習誌.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>