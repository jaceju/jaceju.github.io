
 <!DOCTYPE HTML>
<html lang="zh-tw">
<head>
  <meta charset="UTF-8">
  
    <title>Front Controller 的基本應用技 | 網站製作學習誌</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Jace Ju">
    

    
    <meta name="description" content="剛學 Zend Framework 的朋友通常會遇到兩個麻煩：目錄結構的安排，還有就是怎麼在 index.php (bootstrap) 中使用 Front Controller ？
目錄結構的安排下次有機會再談，這裡我來說說 Front Controller 的用法。
註：在此之前，請大家先看過 Rob Allen 寫的 Getting Started with the Zend Framewo">
<meta property="og:type" content="article">
<meta property="og:title" content="Front Controller 的基本應用技">
<meta property="og:url" content="http://jaceju.net/2008/02/27/317/index.html">
<meta property="og:site_name" content="網站製作學習誌">
<meta property="og:description" content="剛學 Zend Framework 的朋友通常會遇到兩個麻煩：目錄結構的安排，還有就是怎麼在 index.php (bootstrap) 中使用 Front Controller ？
目錄結構的安排下次有機會再談，這裡我來說說 Front Controller 的用法。
註：在此之前，請大家先看過 Rob Allen 寫的 Getting Started with the Zend Framewo">
<meta property="og:updated_time" content="2015-05-11T07:04:31.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Front Controller 的基本應用技">
<meta name="twitter:description" content="剛學 Zend Framework 的朋友通常會遇到兩個麻煩：目錄結構的安排，還有就是怎麼在 index.php (bootstrap) 中使用 Front Controller ？
目錄結構的安排下次有機會再談，這裡我來說說 Front Controller 的用法。
註：在此之前，請大家先看過 Rob Allen 寫的 Getting Started with the Zend Framewo">

    
    <link rel="alternative" href="/atom.xml" title="網站製作學習誌" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="網站製作學習誌" title="網站製作學習誌"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="網站製作學習誌">網站製作學習誌</a></h1>
				<h2 class="blog-motto">記錄在開發網站時所學的一切</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜單">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:jaceju.net">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2008/02/27/317/" title="Front Controller 的基本應用技" itemprop="url">Front Controller 的基本應用技</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Jace Ju" target="_blank" itemprop="author">Jace Ju</a>
		
  <p class="article-time">
    <time datetime="2008-02-26T16:00:00.000Z" itemprop="datePublished"> 發表於 2008-02-27</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目錄</strong>
		
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#什麼是_Front_Controller"><span class="toc-number">1.</span> <span class="toc-text">什麼是 Front Controller</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#基本的_Front_Controller_用法"><span class="toc-number">2.</span> <span class="toc-text">基本的 Front Controller 用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#進階的_Front_Controller_用法"><span class="toc-number">3.</span> <span class="toc-text">進階的 Front Controller 用法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#設定部份"><span class="toc-number">3.1.</span> <span class="toc-text">設定部份</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#執行部份"><span class="toc-number">3.2.</span> <span class="toc-text">執行部份</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#結論"><span class="toc-number">4.</span> <span class="toc-text">結論</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#範例下載"><span class="toc-number">5.</span> <span class="toc-text">範例下載</span></a></li></ol>
		
		</div>
		
		<p>剛學 Zend Framework 的朋友通常會遇到兩個麻煩：目錄結構的安排，還有就是怎麼在 index.php (bootstrap) 中使用 Front Controller ？</p>
<p>目錄結構的安排下次有機會再談，這裡我來說說 Front Controller 的用法。</p>
<p>註：在此之前，請大家先看過 Rob Allen 寫的 <a href="http://akrabat.com/zend-framework-tutorial/" target="_blank" rel="external">Getting Started with the Zend Framework</a> 一文 (<a href="http://akrabat.com/wp-content/uploads/getting-started-with-the-zend-framework_145.pdf" target="_blank" rel="external">PDF 版本</a>) ；本文將會以該篇教學為基礎，一步一步來說明。 </p>
<a id="more"></a>
<h2 id="什麼是_Front_Controller">什麼是 Front Controller</h2><p>整體而言 Front Controller 比較像是一個中介的角色，以下是它常見的幾個功能：</p>
<ul>
<li>處理應用程式的初始化設定並執行之。</li>
<li>管理應用程式執行路徑。</li>
<li>管理輸入 (Request) ，使得使用者的動作得以分派 (&nbsp;Dispatch) 到 Action Controller 中。</li>
<li>管理輸出 (Response) ，使得應用程式能將結果傳送出來。</li>
<li>可以接受 Plugins 來擴充 Front Controller 的行為。</li>
</ul>
<p> Front Controller 裡還有更深入的參數設定機制，不過本文暫且先略過不談。 </p>
<h2 id="基本的_Front_Controller_用法">基本的 Front Controller 用法</h2><p>我們先來看看 Rob 在 <a href="http://akrabat.com/zend-framework-tutorial/" target="_blank" rel="external">Getting Started with the Zend Framework</a> 裡是怎麼用 Front Controller 的： </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#60;?php&#10;error_reporting(E_ALL|E_STRICT);&#10;date_default_timezone_set(&#39;Europe/London&#39;);&#10;set_include_path(&#39;.&#39; . PATH_SEPARATOR . &#39;./library&#39;&#10;. PATH_SEPARATOR . &#39;./application/models/&#39;&#10;. PATH_SEPARATOR . get_include_path());&#10;include &#34;Zend/Loader.php&#34;;&#10;Zend_Loader::loadClass(&#39;Zend_Controller_Front&#39;);&#10;// setup controller&#10;$frontController = Zend_Controller_Front::getInstance();&#10;$frontController-&#62;throwExceptions(true);&#10;$frontController-&#62;setControllerDirectory(&#39;./application/controllers&#39;);&#10;// run!&#10;$frontController-&#62;dispatch();</span><br></pre></td></tr></table></figure>
<p>撇開前面 PHP 的設定部份，我們可以看到 Front Controller 主要分成設定與執行兩個部份。</p>
<p>在設定的部份裡，首先我們可以看到 Front Controller 為 Singleton ，換句話說 Front Controller 在整個應用程式執行的過程中只會有一個實體存在。接著我們再呼叫 Front Controller 的 throwExceptions() 方法，它能為我們設定是否要將 Exception 直接丟出或是放到 Response 物件中。最後我們再設定應用程式的 Action Controller 所在路徑，讓 Front Controller 知道到哪裡能找到要執行的 action 。</p>
<p>當設定好 Front Controller 後，就可以呼叫它的 dispatch() 方法來執行整個應用程式了。</p>
<p>以上就是最簡單的 Front Controller 使用方法，接下來我會介紹目前我所使用的方法。 </p>
<h2 id="進階的_Front_Controller_用法">進階的 Front Controller 用法</h2><p>先來看看程式碼：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#60;?php&#10;error_reporting(E_ALL|E_STRICT);&#10;date_default_timezone_set(&#39;Asia/Taipei&#39;);&#10;// set include_path&#10;define(&#39;ROOT_PATH&#39;, str_replace(&#39;\\&#39;, &#39;/&#39;, dirname(__FILE__)));&#10;$includePath = array(&#10;    ROOT_PATH . &#39;/lib&#39;,&#10;    get_include_path(),&#10;);&#10;set_include_path(join(PATH_SEPARATOR, $includePath));&#10;// autoload&#10;require_once &#39;Zend/Loader.php&#39;;&#10;Zend_Loader::registerAutoload();&#10;// setup controller&#10;$frontController = Zend_Controller_Front::getInstance();&#10;$frontController-&#62;setControllerDirectory(array(&#10;        &#39;default&#39; =&#62; &#39;./app/mod/default/controllers&#39;,&#10;        &#39;admin&#39; =&#62; &#39;./app/mod/admin/controllers&#39;))&#10;    -&#62;throwExceptions(false)&#10;    -&#62;setDefaultModule(&#39;default&#39;)&#10;    -&#62;returnResponse(true);&#10;// run!&#10;$response = $frontController-&#62;dispatch();&#10;if ($response-&#62;isException()) &#123;&#10;    $response-&#62;renderExceptions(true);&#10;&#125;&#10;$response-&#62;sendResponse();</span><br></pre></td></tr></table></figure>
<p>基本上我在 PHP 一般設定的部份和 Rob 的差不多 (因為我也是從他的教學入門的) ，只是我在載入類別的地方做了一些修改而已 (例如自動載入) 。</p>
<h3 id="設定部份">設定部份</h3><p>接下來我們來看 Front Controller 設定的部份：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// setup controller&#10;$frontController = Zend_Controller_Front::getInstance();&#10;$frontController-&#62;setControllerDirectory(array(&#10;        &#39;default&#39; =&#62; &#39;./app/mod/default/controllers&#39;,&#10;        &#39;admin&#39;   =&#62; &#39;./app/mod/admin/controllers&#39;))&#10;    -&#62;setDefaultModule(&#39;default&#39;)&#10;    -&#62;throwExceptions(false)&#10;    -&#62;returnResponse(true);</span><br></pre></td></tr></table></figure>
<p>在 Rob 的教學中因為只需要單一的功能 (也就是專輯管理) ，因此他並沒有使用 Front Controller 的模組設定。而在我所開發的專案中通常會有前後台之分，因此我就應用了 Front Controller 裡的模組功能。使用 Front Controller 模組功能的方法很簡單，就是在 setControllerDirectory() 方法中，給它一個陣列參數；這個陣列參數的 key 即為模組名稱， value 則為模組中 Action Controller 的路徑。</p>
<p>然後我們要設定預設執行的模組，這裡使用的是 setDefaultModule() 方法。預設模組的好處是我們在網址上不必特別指定模組名稱，在上面的例子中即為 default 。如果不是預設的模組，那麼就要在網址中明確指定模組名稱；以 admin 這個模組來說，網址就要輸入： <a href="http://localhost/admin" target="_blank" rel="external">http://localhost/admin</a> 。特別要注意的是網址上的模組名稱參考的是前段說明中的 key ，而非 value 裡的目錄名稱。 </p>
<p>接下來的 throwExceptions() 方法是個 setter 和 getter 的合體，當我們給它參數值時 (true 或 false) 它就是 setter ，反之不提供任何參數時就會是 getter 。前面提到 throwExceptions() 在設定  true 值時， Front Controller 會直接丟出 Exception ，這時程式就會直接中斷 (或是用 try…catch 來接也行) ；而 throwExceptions() 設定 false 值時，  Front Controller 則會將 Exception 放到 Response 物件裡，在稍後處理 Reponse 物件時才會看到 Exception 的內容。</p>
<p>註： throwExceptions() 方法在 setter 時會回傳 Front Controller 物件本身，而成為 getter 時則會回傳 boolean 值；這邊要特別小心，我也曾經在這裡中招。 </p>
<p>最後的 returnResponse() 方法也是個 setter 與 getter 的合體，它主要是設定 Front Controller 的 dispatch() 方法要不要回傳一個 Response 物件。這裡我的做法是永遠回傳 Response 物件 (也就是設定 true 值) ，這樣後面執行的程式碼才不會發生錯誤。 </p>
<h3 id="執行部份">執行部份</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// run!&#10;$response = $frontController-&#62;dispatch();&#10;if ($response-&#62;isException()) &#123;&#10;    $response-&#62;renderExceptions(true);&#10;&#125;&#10;$response-&#62;sendResponse();</span><br></pre></td></tr></table></figure>
<p>在執行的部份，由於我們前面已經用 returnResponse() 方法來設定要回傳 Response 物件，因此 Front Controller 在完成 dispatch() 方法後就會將輸出的結果包裝在 Response 物件中回傳給 index.php 。</p>
<p>接著我們從 Response 物件的 isException() 方法來判斷輸出的結果是不是一個 Exception ，是的話就透過 Response 物件的 renderExceptions() 方法設定是否要顯示 Exception 。如果在這裡 renderExceptions() 方法的參數被設定為 false 時，那麼 Front Controller 就會呼叫預設模組底下 ErrorController 中的 errorAction() 方法，這樣就不會讓前端的瀏覽者看到程式錯誤，而是我們自訂的錯誤頁。</p>
<p>註：這個功能在上線環境中特別重要，你可以在這裡用 Response 物件的 getException() 方法取得 Exception 的內容然後寫入 Log 中，而最後只顯示自訂的 Error 頁面。</p>
<p>最後我們再呼叫 Response 物件的 sendResponse() 方法來將輸出的結果傳送給瀏覽器或 Console ，不論它是不是個 Exception 。</p>
<h2 id="結論">結論</h2><p>以往我們在寫程式時，最頭痛的就是一開始的流程要怎麼寫？程式出現錯誤時要如何呈現？上線環境和開發環境要如何區別？而 Front Controller 正好為我們解決了許多這樣的麻煩；不過相對的它的使用方式也容易讓一般開發者感到迷惑，很多剛接觸的朋友就會在這裡受到很多挫折 (我剛好也是其中之一) 。 </p>
<p>其實 Zend Framework 的 Front Controller 是非常靈活且強大的，這裡僅僅只介紹了它的基本應用方式。後面如果有空的話，我會再介紹其他相關的功能。 </p>
<h2 id="範例下載">範例下載</h2><p>照慣例，範例的下載位址在<a href="/resources/zf_controller_front/front_controller.rar">這裡</a>。 </p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/Zend-Framework/">Zend Framework</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://jaceju.net/2008/02/27/317/" data-title="Front Controller 的基本應用技 | 網站製作學習誌" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2008/02/29/318/" title="目錄結構的安排">
  <strong>上一篇：</strong><br/>
  <span>
  目錄結構的安排</span>
</a>
</div>


<div class="next">
<a href="/2008/02/22/316/"  title="[PHP] PHP 密技： include 與 require">
 <strong>下一篇：</strong><br/> 
 <span>[PHP] PHP 密技： include 與 require
</span>
</a>
</div>

</nav>

	

<section id="comments" class="comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="顯示側邊欄"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目錄</strong>
 
 <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#什麼是_Front_Controller"><span class="toc-number">1.</span> <span class="toc-text">什麼是 Front Controller</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#基本的_Front_Controller_用法"><span class="toc-number">2.</span> <span class="toc-text">基本的 Front Controller 用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#進階的_Front_Controller_用法"><span class="toc-number">3.</span> <span class="toc-text">進階的 Front Controller 用法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#設定部份"><span class="toc-number">3.1.</span> <span class="toc-text">設定部份</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#執行部份"><span class="toc-number">3.2.</span> <span class="toc-text">執行部份</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#結論"><span class="toc-number">4.</span> <span class="toc-text">結論</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#範例下載"><span class="toc-number">5.</span> <span class="toc-text">範例下載</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隱藏側邊欄"></a></div>
<aside class="clearfix">

  


  

  
<div class="tagslist">
	<p class="asidetitle">標簽</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/連結分享/" title="連結分享">連結分享<sup>183</sup></a></li>
			
		
			
				<li><a href="/tags/PHP/" title="PHP">PHP<sup>116</sup></a></li>
			
		
			
				<li><a href="/tags/Zend-Framework/" title="Zend Framework">Zend Framework<sup>57</sup></a></li>
			
		
			
				<li><a href="/tags/JavaScript/" title="JavaScript">JavaScript<sup>46</sup></a></li>
			
		
			
				<li><a href="/tags/心得感想/" title="心得感想">心得感想<sup>34</sup></a></li>
			
		
			
				<li><a href="/tags/Web-開發/" title="Web 開發">Web 開發<sup>26</sup></a></li>
			
		
			
				<li><a href="/tags/CSS/" title="CSS">CSS<sup>22</sup></a></li>
			
		
			
				<li><a href="/tags/伺服器安裝與設定/" title="伺服器安裝與設定">伺服器安裝與設定<sup>18</sup></a></li>
			
		
			
				<li><a href="/tags/Smarty/" title="Smarty">Smarty<sup>16</sup></a></li>
			
		
			
				<li><a href="/tags/程式開發/" title="程式開發">程式開發<sup>14</sup></a></li>
			
		
			
				<li><a href="/tags/好書推薦/" title="好書推薦">好書推薦<sup>14</sup></a></li>
			
		
			
				<li><a href="/tags/Windows/" title="Windows">Windows<sup>13</sup></a></li>
			
		
			
				<li><a href="/tags/作品/" title="作品">作品<sup>13</sup></a></li>
			
		
			
				<li><a href="/tags/好站推薦/" title="好站推薦">好站推薦<sup>11</sup></a></li>
			
		
			
				<li><a href="/tags/開發工具/" title="開發工具">開發工具<sup>9</sup></a></li>
			
		
			
				<li><a href="/tags/ASP/" title="ASP">ASP<sup>8</sup></a></li>
			
		
			
				<li><a href="/tags/測試/" title="測試">測試<sup>8</sup></a></li>
			
		
			
				<li><a href="/tags/電腦知識/" title="電腦知識">電腦知識<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/設計模式/" title="設計模式">設計模式<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/Laravel/" title="Laravel">Laravel<sup>5</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情鏈接</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 訂閱</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=null&verifier=b3593ceb&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Larry Page in Google. <br/>
			This is my blog,believe it or not.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/2176287895" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016 
		
		<a href="/about" target="_blank" title="Jace Ju">Jace Ju</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>




<script type="text/javascript">

var disqus_shortname = 'jaceju';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>






<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回頂部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
