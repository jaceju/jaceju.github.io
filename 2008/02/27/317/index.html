<!doctype html>
<html class="theme-next use-motion ">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>


<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.3"/>




  <meta name="keywords" content="Zend Framework," />





  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.3" />



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    analytics: {
      google: 'UA-450710-8'
    },
    sidebar: 'post'
  };
</script>




  <title> Front Controller 的基本應用技 // 網站製作學習誌 </title>
</head>

<body>
<!--[if lte IE 8]> <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'> <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode"><img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820" alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari." style='margin-left:auto;margin-right:auto;display: block;'/></a></div> <![endif]-->
  <div class="container one-column page-post-detail">
    <div class="headband"></div>

    <div id="header" class="header">
      <div class="header-inner">
        <h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand">
      <span class="logo">
        <i class="icon-logo"></i>
      </span>
      <span class="site-title">網站製作學習誌</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>


  <ul id="menu" class="menu">
     
    
      
      <li class="menu-item menu-item-home">
        <a href="/">
          <i class="menu-item-icon icon-home"></i> <br />
          首頁
        </a>
      </li>
    
      
      <li class="menu-item menu-item-archives">
        <a href="/archives">
          <i class="menu-item-icon icon-archives"></i> <br />
          歸檔
        </a>
      </li>
    
      
      <li class="menu-item menu-item-tags">
        <a href="/tags">
          <i class="menu-item-icon icon-tags"></i> <br />
          標籤
        </a>
      </li>
    
  </ul>


      </div>
    </div>

    <div id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          

  <div id="posts" class="posts-expand">
    

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              Front Controller 的基本應用技
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          發表於 2008-02-27
        </span>

        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2008/02/27/317/#comments" >
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2008/02/27/317/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        <p>剛學 Zend Framework 的朋友通常會遇到兩個麻煩：目錄結構的安排，還有就是怎麼在 index.php (bootstrap) 中使用 Front Controller ？</p>
<p>目錄結構的安排下次有機會再談，這裡我來說說 Front Controller 的用法。</p>
<p>註：在此之前，請大家先看過 Rob Allen 寫的 <a href="http://akrabat.com/zend-framework-tutorial/" target="_blank" rel="external">Getting Started with the Zend Framework</a> 一文 (<a href="http://akrabat.com/wp-content/uploads/getting-started-with-the-zend-framework_145.pdf" target="_blank" rel="external">PDF 版本</a>) ；本文將會以該篇教學為基礎，一步一步來說明。 </p>
<a id="more"></a>
<h2 id="什麼是_Front_Controller">什麼是 Front Controller</h2><p>整體而言 Front Controller 比較像是一個中介的角色，以下是它常見的幾個功能：</p>
<ul>
<li>處理應用程式的初始化設定並執行之。</li>
<li>管理應用程式執行路徑。</li>
<li>管理輸入 (Request) ，使得使用者的動作得以分派 (&nbsp;Dispatch) 到 Action Controller 中。</li>
<li>管理輸出 (Response) ，使得應用程式能將結果傳送出來。</li>
<li>可以接受 Plugins 來擴充 Front Controller 的行為。</li>
</ul>
<p> Front Controller 裡還有更深入的參數設定機制，不過本文暫且先略過不談。 </p>
<h2 id="基本的_Front_Controller_用法">基本的 Front Controller 用法</h2><p>我們先來看看 Rob 在 <a href="http://akrabat.com/zend-framework-tutorial/" target="_blank" rel="external">Getting Started with the Zend Framework</a> 裡是怎麼用 Front Controller 的： </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#60;?php&#10;error_reporting(E_ALL|E_STRICT);&#10;date_default_timezone_set(&#39;Europe/London&#39;);&#10;set_include_path(&#39;.&#39; . PATH_SEPARATOR . &#39;./library&#39;&#10;. PATH_SEPARATOR . &#39;./application/models/&#39;&#10;. PATH_SEPARATOR . get_include_path());&#10;include &#34;Zend/Loader.php&#34;;&#10;Zend_Loader::loadClass(&#39;Zend_Controller_Front&#39;);&#10;// setup controller&#10;$frontController = Zend_Controller_Front::getInstance();&#10;$frontController-&#62;throwExceptions(true);&#10;$frontController-&#62;setControllerDirectory(&#39;./application/controllers&#39;);&#10;// run!&#10;$frontController-&#62;dispatch();</span><br></pre></td></tr></table></figure>
<p>撇開前面 PHP 的設定部份，我們可以看到 Front Controller 主要分成設定與執行兩個部份。</p>
<p>在設定的部份裡，首先我們可以看到 Front Controller 為 Singleton ，換句話說 Front Controller 在整個應用程式執行的過程中只會有一個實體存在。接著我們再呼叫 Front Controller 的 throwExceptions() 方法，它能為我們設定是否要將 Exception 直接丟出或是放到 Response 物件中。最後我們再設定應用程式的 Action Controller 所在路徑，讓 Front Controller 知道到哪裡能找到要執行的 action 。</p>
<p>當設定好 Front Controller 後，就可以呼叫它的 dispatch() 方法來執行整個應用程式了。</p>
<p>以上就是最簡單的 Front Controller 使用方法，接下來我會介紹目前我所使用的方法。 </p>
<h2 id="進階的_Front_Controller_用法">進階的 Front Controller 用法</h2><p>先來看看程式碼：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#60;?php&#10;error_reporting(E_ALL|E_STRICT);&#10;date_default_timezone_set(&#39;Asia/Taipei&#39;);&#10;// set include_path&#10;define(&#39;ROOT_PATH&#39;, str_replace(&#39;\\&#39;, &#39;/&#39;, dirname(__FILE__)));&#10;$includePath = array(&#10;    ROOT_PATH . &#39;/lib&#39;,&#10;    get_include_path(),&#10;);&#10;set_include_path(join(PATH_SEPARATOR, $includePath));&#10;// autoload&#10;require_once &#39;Zend/Loader.php&#39;;&#10;Zend_Loader::registerAutoload();&#10;// setup controller&#10;$frontController = Zend_Controller_Front::getInstance();&#10;$frontController-&#62;setControllerDirectory(array(&#10;        &#39;default&#39; =&#62; &#39;./app/mod/default/controllers&#39;,&#10;        &#39;admin&#39; =&#62; &#39;./app/mod/admin/controllers&#39;))&#10;    -&#62;throwExceptions(false)&#10;    -&#62;setDefaultModule(&#39;default&#39;)&#10;    -&#62;returnResponse(true);&#10;// run!&#10;$response = $frontController-&#62;dispatch();&#10;if ($response-&#62;isException()) &#123;&#10;    $response-&#62;renderExceptions(true);&#10;&#125;&#10;$response-&#62;sendResponse();</span><br></pre></td></tr></table></figure>
<p>基本上我在 PHP 一般設定的部份和 Rob 的差不多 (因為我也是從他的教學入門的) ，只是我在載入類別的地方做了一些修改而已 (例如自動載入) 。</p>
<h3 id="設定部份">設定部份</h3><p>接下來我們來看 Front Controller 設定的部份：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// setup controller&#10;$frontController = Zend_Controller_Front::getInstance();&#10;$frontController-&#62;setControllerDirectory(array(&#10;        &#39;default&#39; =&#62; &#39;./app/mod/default/controllers&#39;,&#10;        &#39;admin&#39;   =&#62; &#39;./app/mod/admin/controllers&#39;))&#10;    -&#62;setDefaultModule(&#39;default&#39;)&#10;    -&#62;throwExceptions(false)&#10;    -&#62;returnResponse(true);</span><br></pre></td></tr></table></figure>
<p>在 Rob 的教學中因為只需要單一的功能 (也就是專輯管理) ，因此他並沒有使用 Front Controller 的模組設定。而在我所開發的專案中通常會有前後台之分，因此我就應用了 Front Controller 裡的模組功能。使用 Front Controller 模組功能的方法很簡單，就是在 setControllerDirectory() 方法中，給它一個陣列參數；這個陣列參數的 key 即為模組名稱， value 則為模組中 Action Controller 的路徑。</p>
<p>然後我們要設定預設執行的模組，這裡使用的是 setDefaultModule() 方法。預設模組的好處是我們在網址上不必特別指定模組名稱，在上面的例子中即為 default 。如果不是預設的模組，那麼就要在網址中明確指定模組名稱；以 admin 這個模組來說，網址就要輸入： <a href="http://localhost/admin" target="_blank" rel="external">http://localhost/admin</a> 。特別要注意的是網址上的模組名稱參考的是前段說明中的 key ，而非 value 裡的目錄名稱。 </p>
<p>接下來的 throwExceptions() 方法是個 setter 和 getter 的合體，當我們給它參數值時 (true 或 false) 它就是 setter ，反之不提供任何參數時就會是 getter 。前面提到 throwExceptions() 在設定  true 值時， Front Controller 會直接丟出 Exception ，這時程式就會直接中斷 (或是用 try…catch 來接也行) ；而 throwExceptions() 設定 false 值時，  Front Controller 則會將 Exception 放到 Response 物件裡，在稍後處理 Reponse 物件時才會看到 Exception 的內容。</p>
<p>註： throwExceptions() 方法在 setter 時會回傳 Front Controller 物件本身，而成為 getter 時則會回傳 boolean 值；這邊要特別小心，我也曾經在這裡中招。 </p>
<p>最後的 returnResponse() 方法也是個 setter 與 getter 的合體，它主要是設定 Front Controller 的 dispatch() 方法要不要回傳一個 Response 物件。這裡我的做法是永遠回傳 Response 物件 (也就是設定 true 值) ，這樣後面執行的程式碼才不會發生錯誤。 </p>
<h3 id="執行部份">執行部份</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// run!&#10;$response = $frontController-&#62;dispatch();&#10;if ($response-&#62;isException()) &#123;&#10;    $response-&#62;renderExceptions(true);&#10;&#125;&#10;$response-&#62;sendResponse();</span><br></pre></td></tr></table></figure>
<p>在執行的部份，由於我們前面已經用 returnResponse() 方法來設定要回傳 Response 物件，因此 Front Controller 在完成 dispatch() 方法後就會將輸出的結果包裝在 Response 物件中回傳給 index.php 。</p>
<p>接著我們從 Response 物件的 isException() 方法來判斷輸出的結果是不是一個 Exception ，是的話就透過 Response 物件的 renderExceptions() 方法設定是否要顯示 Exception 。如果在這裡 renderExceptions() 方法的參數被設定為 false 時，那麼 Front Controller 就會呼叫預設模組底下 ErrorController 中的 errorAction() 方法，這樣就不會讓前端的瀏覽者看到程式錯誤，而是我們自訂的錯誤頁。</p>
<p>註：這個功能在上線環境中特別重要，你可以在這裡用 Response 物件的 getException() 方法取得 Exception 的內容然後寫入 Log 中，而最後只顯示自訂的 Error 頁面。</p>
<p>最後我們再呼叫 Response 物件的 sendResponse() 方法來將輸出的結果傳送給瀏覽器或 Console ，不論它是不是個 Exception 。</p>
<h2 id="結論">結論</h2><p>以往我們在寫程式時，最頭痛的就是一開始的流程要怎麼寫？程式出現錯誤時要如何呈現？上線環境和開發環境要如何區別？而 Front Controller 正好為我們解決了許多這樣的麻煩；不過相對的它的使用方式也容易讓一般開發者感到迷惑，很多剛接觸的朋友就會在這裡受到很多挫折 (我剛好也是其中之一) 。 </p>
<p>其實 Zend Framework 的 Front Controller 是非常靈活且強大的，這裡僅僅只介紹了它的基本應用方式。後面如果有空的話，我會再介紹其他相關的功能。 </p>
<h2 id="範例下載">範例下載</h2><p>照慣例，範例的下載位址在<a href="/resources/zf_controller_front/front_controller.rar">這裡</a>。 </p>

      
    </div>

    <div class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Zend-Framework/"> #Zend Framework </a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-prev post-nav-item">
            
              <a href="/2008/02/29/318/">目錄結構的安排</a>
            
          </div>

          <div class="post-nav-next post-nav-item">
            
              <a href="/2008/02/22/315/">[Web] 連結分享</a>
            
          </div>
        </div>
      

      
      
    </div>
  </div>



    
      <div class="comments" id="comments">
        
          <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          </div>
        
      </div>
    
  </div>


        </div>

        
      </div>


      
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <div id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目錄
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            本站概覽
          </li>
        </ul>
      

      <div class="site-overview">
        <div class="site-author motion-element">
          <img class="site-author-image" src="/images/default_avatar.jpg" alt="Jace Ju" />
          <p class="site-author-name">Jace Ju</p>
        </div>
        <p class="site-description motion-element"></p>
        <div class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">582</span>
              <span class="site-state-item-name">文章</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">0</span>
              <span class="site-state-item-name">分類</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">51</span>
              <span class="site-state-item-name">標籤</span>
              </a>
          </div>

        </div>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
              <a href="https://github.com/jaceju" target="_blank">GitHub</a>
            </span>
            
              <span class="links-of-author-item">
              <a href="https://twitter.com/jaceju" target="_blank">Twitter</a>
            </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element">
            <a href="http://creativecommons.org/licenses/by-nc-sa/4.0" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
            </a>
          </div>
        

      </div>

      
        <div class="post-toc-wrap sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator"></div>
          <div class="post-toc">
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#什麼是_Front_Controller"><span class="nav-number">1.</span> <span class="nav-text">什麼是 Front Controller</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#基本的_Front_Controller_用法"><span class="nav-number">2.</span> <span class="nav-text">基本的 Front Controller 用法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#進階的_Front_Controller_用法"><span class="nav-number">3.</span> <span class="nav-text">進階的 Front Controller 用法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#設定部份"><span class="nav-number">3.1.</span> <span class="nav-text">設定部份</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#執行部份"><span class="nav-number">3.2.</span> <span class="nav-text">執行部份</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#結論"><span class="nav-number">4.</span> <span class="nav-text">結論</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#範例下載"><span class="nav-number">5.</span> <span class="nav-text">範例下載</span></a></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator"></div>
        </div>
      

    </div>
  </div>


    </div>

    <div id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; &nbsp; 
  2015
  <span class="with-love">
    <i class="icon-heart"></i>
  </span>
  <span class="author">Jace Ju</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 強力驅動
</div>

<div class="theme-info">
  主題 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>



      </div>
    </div>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js"></script>


  <script type="text/javascript" src="/js/helpers.js"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js" id="motion.global"></script>




  
  
<script type="text/javascript" src="/js/bootstrap.scrollspy.js" id="bootstrap.scrollspy.custom"></script>


<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var $sidebarInner = $('.sidebar-inner');
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.didShow', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;
          var self = this;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      $(indicator).velocity('stop').velocity({
        opacity: action === 'show' ? 0.4 : 0
      }, { duration: 100 });
    }

  });
</script>


  <script type="text/javascript" id="sidebar.nav">
    $(document).ready(function () {
      var html = $('html');

      $('.sidebar-nav li').on('click', function () {
        var item = $(this);
        var activeTabClassName = 'sidebar-nav-active';
        var activePanelClassName = 'sidebar-panel-active';
        if (item.hasClass(activeTabClassName)) {
          return;
        }

        var currentTarget = $('.' + activePanelClassName);
        var target = $('.' + item.data('target'));

        currentTarget.velocity('transition.slideUpOut', 200, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', 200)
            .addClass(activePanelClassName);
        });

        item.siblings().removeClass(activeTabClassName);
        item.addClass(activeTabClassName);
      });

      $('.post-toc a').on('click', function (e) {
        e.preventDefault();
        var offset = $(escapeSelector(this.getAttribute('href'))).offset().top;
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        });
      });

      // Expand sidebar on post detail page by default, when post has a toc.
      var $tocContent = $('.post-toc-content');
      if (isDesktop() && CONFIG.sidebar === 'post') {
        if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
          displaySidebar();
        }
      }
    });
  </script>




  <script type="text/javascript">
    $(document).ready(function () {
      if (CONFIG.sidebar === 'always') {
        displaySidebar();
      }
    });
  </script>

  

  
  
  

  

    
      
    

    <script type="text/javascript">
      var disqus_shortname = 'jaceju';
      var disqus_identifier = '2008/02/27/317/';
      var disqus_title = 'Front Controller 的基本應用技';
      var disqus_url = 'http://jaceju.net/2008/02/27/317/';

      (function(){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }());
    </script>
  




  
  
  <script type="text/javascript" src="/js/analytics_google-analytics.js"></script>


</body>
</html>
